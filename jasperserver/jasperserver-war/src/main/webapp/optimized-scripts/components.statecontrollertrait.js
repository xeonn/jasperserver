jaspersoft.components.StateControllerTrait=function(e,t,n,r,s){return{initialize:function(e){t.bindAll(this),this.model&&(this.model.on("change:phase",this.handleStateChanges),this.model.on("change:id",this.startObserver)),e&&(this.timeout=e.timeout,this.delay=e.delay)},handleStateChanges:function(e,t){t===s.INPROGRESS?this.handleInprogressPhase(e):t===s.READY?this.handleReadyPhase(e):t===s.FAILED&&this.handleFailedPhase(e)},startObserver:function(e){var t=e.get("phase");this.intervalId||t!=s.INPROGRESS&&t!=s.NOT_STARTED||(this.intervalId=this.observePhase(e,this.timeout))},handleInprogressPhase:function(){},handleReadyPhase:function(){this.reset()},handleFailedPhase:function(){},handleServerError:function(e){e.defaultErrorDelegator.apply(e,arguments),this.reset()},observePhase:function(e,n){function a(){var e=(new Date).getTime();return e-h>=n}var i,h=(new Date).getTime(),o=this;return i=setInterval(t.bind(function(){var t=e.get("phase"),n=function(t){clearInterval(i),delete o.intervalId,t&&e.set({phase:s.FAILED,message:r[t]})};if(t===s.INPROGRESS)if(a())n("error.timeout");else try{e.fetch({error:this.handleServerError})}catch(h){n("error.invalid.request")}else n()},this),this.delay)},reset:function(){this.model&&this.model.reset(),this.intervalId&&(clearInterval(this.intervalId),delete this.intervalId)}}}(jQuery,_,Backbone,jaspersoft.i18n,jaspersoft.components.State);