define(["require","underscore","jquery","bundle!all","common/model/RepositoryResourceModel","resource.locate","dataSource/enum/mongoJdbcFileSourceTypes","dataSource/view/CustomDataSourceView","dataSource/model/MongoDbJdbcDataSourceModel","text!dataSource/template/mongoDbSpecificTemplate.htm","text!dataSource/template/mongoDbJdbcFileLocationSectionTemplate.htm","text!common/templates/components.pickers.htm"],function(e){"use strict";var t=e("underscore"),o=e("jquery"),i=e("bundle!all"),r=(e("common/model/RepositoryResourceModel"),e("resource.locate")),a=e("dataSource/enum/mongoJdbcFileSourceTypes"),n=e("dataSource/view/CustomDataSourceView"),s=e("dataSource/model/MongoDbJdbcDataSourceModel"),l=e("text!dataSource/template/mongoDbSpecificTemplate.htm"),c=e("text!dataSource/template/mongoDbJdbcFileLocationSectionTemplate.htm"),d=e("text!common/templates/components.pickers.htm");return n.extend({PAGE_TITLE_NEW_MESSAGE_CODE:"resource.datasource.mongoJdbc.page.title.new",PAGE_TITLE_EDIT_MESSAGE_CODE:"resource.datasource.mongoJdbc.page.title.edit",modelConstructor:s,browseButton:!1,events:function(){var e=t.extend({},n.prototype.events);return e["change [name=fileSourceType]"]="changeFileSourceType",e},initialize:function(){n.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:serverFileName",this.adjustFileSystemConnectButton)},changeFileSourceType:function(){t.defer(t.bind(function(){this.renderFileLocationSection()},this))},render:function(){return this.$el.empty(),this.renderMongoDbSpecificSection(),this.renderFileLocationSection(),this.$el.find("[name=serverAddress]").focus(),this},validationMethodOnSaveClick:function(e){!this.model.get("parentFolderUri")&&this.model.set("parentFolderUri","/"),!this.model.get("label")&&this.model.set("label",o("[name=dataSourceType] option:selected").text());var r=this;this.model.save({},{dryRun:!0}).fail(function(e){var o=!1;try{o=JSON.parse(e.responseText)}catch(a){}var n=t.isArray(o)?o:[o];t.each(n,function(e){e&&e.errorCode&&e.parameters&&("illegal.parameter.value.error"===e.errorCode&&"resourceReference.uri"===e.parameters[0]?r.fieldIsInvalid(r,"repositoryFileName",i["resource.file.invalid.path"],"name"):"invalid.server.file.system.path"===e.errorCode&&"textDataSource.propertyMap[fileName]"===e.parameters[0]&&r.fieldIsInvalid(r,"serverFileName",i["resource.file.invalid.path"],"name"))})}).done(e)},templateData:function(){var e=t.extend({},a);return this.model.isLocalFileSystemAccessAllowed()||delete e.SERVER_FILE_SYSTEM,t.extend(n.prototype.templateData.apply(this,arguments),{fileSourceTypeOptions:e})},renderMongoDbSpecificSection:function(){this.$el.append(t.template(l,this.templateData()))},renderFileLocationSection:function(){this.renderOrAddAnyBlock(this.$el.find("[name=fileLocationContainer]"),t.template(c,this.templateData())),this.browseButton&&(this.browseButton.remove(),this.browseButton=!1),"repository"===this.model.get("fileSourceType")&&(this.browseButton=r.initialize({i18n:i,template:d,resourceInput:this.$el.find("[name=repositoryFileName]")[0],browseButton:this.$el.find("[name=repositoryBrowserButton]")[0],providerId:"fileResourceBaseTreeDataProvider",dialogTitle:i["resource.Add.Files.Title"],selectLeavesOnly:!0,onChange:t.bind(function(e){this.model.set("repositoryFileName",e),this.model.validate({repositoryFileName:e})},this)})),this.adjustFileSystemConnectButton()},adjustFileSystemConnectButton:function(){var e=this.model.isValid("serverFileName");this._adjustButton("serverFileSystemConnectToServer",e)},_adjustButton:function(e,t){var o=this.$el.find("[name="+e+"]");t?o.removeAttr("disabled"):o.attr("disabled","disabled")}})});