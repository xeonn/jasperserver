define("scheduler/view/editor/output",["require","jquery","underscore","backbone","jrs.configs","bundle!jasperserver_messages","components.pickers","resource.base"],function(t){{var e=t("jquery"),o=t("underscore"),r=t("backbone"),n=t("jrs.configs"),i=t("bundle!jasperserver_messages"),s=t("components.pickers");t("resource.base")}return r.View.extend({el:"#scheduler_editor .tab[data-tab=output]",events:{"click .ftp-test":"testFTPConnection"},initialize:function(){var t=this;t.$("[name=outputToHostFileSystem]").attr("disabled","true"===n.enableSaveToHostFS?!1:"disabled"),t.map=[{attr:"baseOutputFilename",control:"baseOutputFilename"},{attr:"repositoryDestination/outputDescription",control:"outputDescription"},{attr:"outputTimeZone",control:"timeZone"},{attr:"outputLocale",control:"outputLocale"},{attr:"outputFormats/outputFormat",control:"outputFormats"},{attr:"repositoryDestination/overwriteFiles",control:"overwriteFiles"},{attr:"repositoryDestination/sequentialFilenames",control:"sequentialFilenames"},{attr:"repositoryDestination/timestampPattern",control:"timestampPattern"},{attr:"repositoryDestination",control:"timestampPattern",depends:"repositoryDestination/sequentialFilenames"},{attr:"repositoryDestination/saveToRepository",control:"outputToRepository"},{attr:"repositoryDestination",control:"outputRepository, outputRepositoryButton",depends:"repositoryDestination/saveToRepository"},{attr:"repositoryDestination/folderURI",control:"outputRepository"},{attr:"repositoryDestination",control:"outputHostFileSystem",depends:"repositoryDestination/outputLocalFolder",disabled:!n.enableSaveToHostFS},{attr:"repositoryDestination/outputLocalFolder",control:"outputToHostFileSystem",getter:function(t){return!1===t?null:""},setter:function(t){return""===t||!!t}},{attr:"repositoryDestination/outputLocalFolder",control:"outputHostFileSystem"},{attr:"repositoryDestination/outputFTPInfo/enabled",control:"outputToFTPServer",getter:function(e){return e===!1&&t.$("#ftpServerOutput").find(".error").removeClass("error"),e}},{attr:"repositoryDestination/outputFTPInfo",control:"ftpAddress, ftpDirectory, ftpUsername, ftpPassword, ftpTestButton, ftpPort, useFTPS",depends:"repositoryDestination/outputFTPInfo/enabled"},{attr:"repositoryDestination/outputFTPInfo/serverName",control:"ftpAddress"},{attr:"repositoryDestination/outputFTPInfo/folderPath",control:"ftpDirectory"},{attr:"repositoryDestination/outputFTPInfo/userName",control:"ftpUsername",setter:function(t){return"anonymous"==t?null:t}},{attr:"repositoryDestination/outputFTPInfo/password",control:"ftpPassword"},{attr:"repositoryDestination/outputFTPInfo/port",control:"ftpPort"}],o.each(t.map,function(r){if(r.control=r.control.split(","),r.control=r.control.map(function(t){return"[name="+t+"]"}),r.control=t.$(r.control.join(",")),r.attr&&(r.attr=r.attr.split("/")),r.depends&&"!"===r.depends[0]&&(r.invert=!0,r.depends=r.depends.substr(1)),r.depends&&!r.attr){r.depends=t.$("[name="+r.depends+"]");var n=function(){var t=r.setter?r.setter(r.depends):r.depends.val();r.control.attr("disabled",r.disabled?"disabled":r.invert?!!t:!t)};return r.depends.on("change",n),n()}t.model.on("change:"+r.attr[0],function(t,e){if(e=t.value(r.attr.join("/")),r.setter&&(e=r.setter(e)),r.depends){var o=t.value(r.depends);return r.setter?o=r.setter(o):""===o&&(o=!0),r.control.attr("disabled",r.disabled?"disabled":r.invert?!!o:!o)}r.control.is("[type=checkbox]")&&1===r.control.length?r.control.prop("checked",e):r.control.is("[type=radio]")?r.control.filter("[value="+e+"]").prop("checked",!0):r.control.val(e)}),r.control.length&&!r.depends&&r.control.on("change",function(){var n,i,s,a;if(i=r.control.is("[type=checkbox]")?r.control.filter(":checked").map(function(){return e(this).val()}).get():r.control.val(),r.control.is("[type=checkbox]")&&1===r.control.length&&(i=!!i[0]),r.control.is("[type=radio]")&&(i=r.control.filter(":checked").val()),r.getter&&(i=r.getter(i,o.clone(t.model.value(r.attr.join("/"))))),r.attr.length>1){a=s=o.clone(t.model.get(r.attr[0]));for(var p=1,u=r.attr.length-1;u>p;p++)n=r.attr[p],a[n]=a[n]?o.clone(a[n]):{},a=a[n];a[r.attr[r.attr.length-1]]=i}t.model.update(r.attr[0],s||i)})}),t.$("[name=useFTPS]").on("click",function(){var o="TYPE_FTP",r="21";e(this).is(":checked")&&(o="TYPE_FTPS",r="990");var n=e.extend(!0,{},t.model.get("repositoryDestination"));n=n||{},n.outputFTPInfo=n.outputFTPInfo||{},n.outputFTPInfo.type=o,n.outputFTPInfo.port=r,t.model.update("repositoryDestination",n)}),t.model.on("save",function(e,o){if(t.model.get("repositoryDestination").saveToRepository){var r=o();t.model.permission(function(e,o){if(e||1!==o&&30!==o){try{e=JSON.parse(e.responseText)}catch(n){e={errorCode:""}}var i="error.report.job.output.folder.notwriteable";"resource.not.found"===e.errorCode&&(i="error.report.job.report.inexistent.output"),t.model.trigger("error",t.model,[{field:"outputRepository",errorCode:i,errorArguments:[t.model.get("repositoryDestination").folderURI]}],{switchToErrors:!0})}else r()})}}),t.model.on("change:repositoryDestination",function(e){var o=e.get("repositoryDestination");t.$("[name=ftpPort]").val(o.outputFTPInfo.port),t.$("[name=useFTPS]").prop("checked","TYPE_FTPS"===o.outputFTPInfo.type)}),new s.FileSelector({treeId:"repoTree",providerId:"repositoryTreeFoldersProvider",treeOptions:{organizationId:"organizationId",publicFolderUri:"publicFolderUri"},uriTextboxId:"outputRepository",browseButtonId:"browser_button",title:i["report.scheduling.repository.content"],onOk:function(){outputRepository.setValue(e("outputRepository").val()),e("#outputRepository").trigger("change")}})},testFTPConnection:function(){e("#ftpTestButton").addClass("disabled"),this.model.testFTPConnection(function(){e("#ftpTestButton").removeClass("disabled")})}})});