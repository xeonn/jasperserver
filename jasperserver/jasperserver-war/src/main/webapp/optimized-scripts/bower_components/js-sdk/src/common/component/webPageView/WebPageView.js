define(["require","backbone","underscore","jquery","common/util/browserDetection","bundle!CommonBundle","css!webPageView.css"],function(e){function i(){this.$iframe.attr("src",this.url),this._iframeSrcSet=!0,this.$iframe.css({"background-color":"transparent"}),this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this._loadingTimeoutId=setTimeout(r.bind(function(){this.$iframe.css("background-color","#FFFFFF")},this),this.timeout)}{var t=e("backbone"),r=e("underscore"),s=e("jquery"),n=e("common/util/browserDetection");e("bundle!CommonBundle")}e("css!webPageView.css");var o=t.View.extend({tagName:"div",className:"webPageView",constructor:function(e){if(e||(e={}),e.renderTo&&(!s(e.renderTo)[0]||!s(e.renderTo)[0].tagName))throw new Error("WebPageView cannot be rendered to specified container");this.renderTo=e.renderTo,this.url=e.url,this.scrolling=r.isUndefined(e.scrolling)?o.SCROLLING:e.scrolling,this.timeout=r.isUndefined(e.timeout)?o.TIMEOUT:e.timeout,t.View.prototype.constructor.apply(this,arguments)},initialize:function(){this.$iframe=s("<iframe></iframe>").addClass("externalUrlIframe"),this.$iframe.on("load",function(){s(this).blur(),s(this).parent().focus()}),this.$el.html(this.$iframe),this.$el.addClass("invisible"),s("body").append(this.$el),this.setScrolling(this.scrolling,{silent:!0}),this.url&&r.isString(this.url)&&(i.call(this),this.renderTo&&this.render(this.renderTo))},render:function(e){if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");if(!e||!s(e)[0]||!s(e)[0].tagName)throw new Error("WebPageView cannot be rendered to specified container");this._iframeSrcSet||i.call(this);var t=this.$el.detach();return t.removeClass("invisible"),s(e).html(t),this._rendered=!0,this.trigger("render",this,s(e)),this},setUrl:function(e,i){this.url=e,this.trigger("change:url",this,this.url),i||this.refresh()},setTimeout:function(e){this.timeout=e,this.trigger("change:timeout",this,this.timeout)},setScrolling:function(e,i){this.scrolling=e,this.$iframe.attr("scrolling",this.scrolling?"yes":"no"),n.isIPad()&&(this.scrolling?this.$el.addClass("touchScroll"):this.$el.removeClass("touchScroll")),i&&i.silent||this.trigger("change:scrolling",this,this.scrolling)},refresh:function(){if(!this._rendered)throw new Error("WebPageView must be rendered to a specific container first");if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");i.call(this),this.trigger("refresh",this,this.url)},remove:function(){this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this.$iframe.off("load"),this.trigger("remove",this),t.View.prototype.remove.apply(this,arguments)}},{TIMEOUT:2e4,SCROLLING:!0,open:function(e,i){var t;try{var s=new o(r.isObject(e)?e:{url:e})}catch(n){if(t=n,!i||!r.isFunction(i))throw n}return i&&r.isFunction(i)&&i(t,s),s}});return o});