define(["require","backbone","underscore","jquery","common/util/browserDetection","css!webPageView"],function(i){"use strict";function e(){this.$iframe.attr("src",this.url),this._iframeSrcSet=!0,this.$iframe.css({"background-color":"transparent"}),this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this._loadingTimeoutId=setTimeout(r.bind(function(){this.$iframe.css("background-color","#FFFFFF")},this),this.timeout)}var t=i("backbone"),r=i("underscore"),s=i("jquery"),n=i("common/util/browserDetection");i("css!webPageView");var o=t.View.extend({tagName:"div",className:"webPageView",constructor:function(i){if(i||(i={}),i.renderTo&&(!s(i.renderTo)[0]||!s(i.renderTo)[0].tagName))throw new Error("WebPageView cannot be rendered to specified container");this.renderTo=i.renderTo,this.url=i.url,this.scrolling=r.isUndefined(i.scrolling)?o.SCROLLING:i.scrolling,this.timeout=r.isUndefined(i.timeout)?o.TIMEOUT:i.timeout,t.View.prototype.constructor.apply(this,arguments)},initialize:function(){var i=this;this.$iframe=s("<iframe></iframe>").addClass("externalUrlIframe"),this.$iframe.on("load",function(){s(this).blur(),s(this).parent().focus(),i.trigger("load")}),this.$el.html(this.$iframe),this.$el.addClass("invisible"),s("body").append(this.$el),this.setScrolling(this.scrolling,{silent:!0}),this.url&&r.isString(this.url)&&(e.call(this),this.renderTo&&this.render(this.renderTo))},render:function(i){if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");if(!i||!s(i)[0]||!s(i)[0].tagName)throw new Error("WebPageView cannot be rendered to specified container");this._iframeSrcSet||e.call(this);var t=this.$el.detach();return t.removeClass("invisible"),s(i).html(t),this._rendered=!0,this.trigger("render",this,s(i)),this},setUrl:function(i,e){this.url=i,this.trigger("change:url",this,this.url),e||this.refresh()},setTimeout:function(i){this.timeout=i,this.trigger("change:timeout",this,this.timeout)},setScrolling:function(i,e){this.scrolling=i,this.$iframe.attr("scrolling",this.scrolling?"yes":"no"),n.isIPad()&&(this.scrolling?this.$el.addClass("touchScroll"):this.$el.removeClass("touchScroll")),e&&e.silent||this.trigger("change:scrolling",this,this.scrolling)},refresh:function(){if(!this._rendered)throw new Error("WebPageView must be rendered to a specific container first");if(!this.url||!r.isString(this.url))throw new Error("WebPageView URL is not specified");e.call(this),this.trigger("refresh",this,this.url)},remove:function(){this._loadingTimeoutId&&clearTimeout(this._loadingTimeoutId),this.$iframe.off("load"),this.trigger("remove",this),t.View.prototype.remove.apply(this,arguments)}},{TIMEOUT:2e4,SCROLLING:!0,open:function(i,e){var t,s;try{t=new o(r.isObject(i)?i:{url:i})}catch(n){if(s=n,!e||!r.isFunction(e))throw n}return e&&r.isFunction(e)&&e(s,t),t}});return o});