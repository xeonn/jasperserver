define(["require","./Tree","jquery","underscore","json3","./TreeDataLayer","./plugin/TooltipPlugin","common/enum/repositoryResourceTypes","text!./template/repositoryFoldersTreeLevelTemplate.htm","bundle!CommonBundle","jrs.configs"],function(e){function r(e){var r=2;return e.isWritable&&(r=4|r),e.isRemovable&&(r=16|r),e.isAdministrable&&(r=1),r}var o=e("./Tree"),t=e("jquery"),i=e("underscore"),s=e("json3"),l=e("./TreeDataLayer"),n=e("./plugin/TooltipPlugin"),a=e("common/enum/repositoryResourceTypes"),u=e("text!./template/repositoryFoldersTreeLevelTemplate.htm"),c=e("bundle!CommonBundle"),d=e("jrs.configs"),p={folderTreeProcessor:{processItem:function(e){return e._node=!0,e._readonly=!(1==e.value.permissionMask||4&e.value.permissionMask),e}},filterPublicFolderProcessor:{processItem:function(e){return e.value.uri!==d.publicFolderUri&&e.value.uri!==d.tempFolderUri?e:void 0}},i18n:{processItem:function(e){return e.i18n=c,e}}};return{repositoryFoldersTree:function(e){return o.use(n).create().instance({additionalCssClasses:"folders",dataUriTemplate:e.contextPath+"/rest_v2/resources?{{= id != '@fakeRoot' ? 'folderUri=' + id : ''}}&recursive=false&type="+a.FOLDER+"&offset={{= offset }}&limit={{= limit }}",levelDataId:"uri",itemsTemplate:u,collapsed:!0,lazyLoad:!0,rootless:!0,selection:{allowed:!0,multiple:!1},customDataLayers:{"/":i.extend(new l({dataUriTemplate:e.contextPath+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:i.chain(p).omit("filterPublicFolderProcessor").values().value(),getDataArray:function(e){e=s.parse(t(e).text());var o=i.find(e.children,function(e){return"/public"===e.uri});return[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",permissionMask:r(e.extra),_links:{content:"@fakeContentLink"}},{id:"/public",label:o.label,uri:"/public",resourceType:"folder",permissionMask:r(o.extra),_links:{content:"@fakeContentLink"}}]}}),{accept:"text/html",dataType:"text"})},processors:[p.i18n,p.folderTreeProcessor,p.filterPublicFolderProcessor],getDataArray:function(e){return e?e[a.RESOURCE_LOOKUP]:[]}})}}});