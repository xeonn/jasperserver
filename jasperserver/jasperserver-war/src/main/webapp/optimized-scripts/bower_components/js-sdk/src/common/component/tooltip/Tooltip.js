define(["require","jquery","underscore","backbone","text!./template/tooltipTemplate.htm"],function(t){var e=t("jquery"),s=t("underscore"),o=t("backbone"),i=t("text!./template/tooltipTemplate.htm");return o.View.extend({template:s.template(i),delay:500,offset:{x:10,y:10},attribute:"data-tooltip",cssClasses:"panel info tooltip",contentSelector:".body",triggerEvents:!1,el:function(){return this.template({cssClasses:this.cssClasses})},constructor:function(t){if(t||(t={}),!t.attachTo||0===e(t.attachTo).length)throw new Error("Tooltip should be attached to an element");this._shown=!1,this.$attachTo=e(t.attachTo),this.$attachTo[0].tooltip=this,t.delay&&(this.delay=t.delay),t.offset&&(this.offset=t.offset),t.attribute&&(this.attribute=t.attribute),t.cssClasses&&(this.cssClasses=t.cssClasses),!s.isUndefined(t.triggerEvents)&&(this.triggerEvents=t.triggerEvents),this.selector="["+this.attribute+"]",s.bindAll(this,"show","_onMouseMove","_onMouseEnter","_onMouseLeave"),this.$attachTo.delegate(this.selector,"mousemove touchmove",this._onMouseMove),this.$attachTo.delegate(this.selector,"mouseenter touchstart",this._onMouseEnter),this.$attachTo.delegate(this.selector,"mouseleave touchend",this._onMouseLeave),o.View.prototype.constructor.apply(this,arguments)},render:function(){if(!this._event)return this;var t=e(this._event.currentTarget).attr(this.attribute);return this.$(this.contentSelector).html(t),this},show:function(){this.render(),e("body").append(this.$el),this._updatePosition(),this._shown=!0,this.triggerEvents&&this.trigger("show",this)},hide:function(){this.$el.detach(),this._shown=!1,this.triggerEvents&&this.trigger("hide",this)},_updatePosition:function(){var t=this.$el.innerHeight(),s=this.$el.innerWidth(),o=e(window).height(),i=e(window).width(),h=this.offset.y,n=this.offset.x;t+this._event.pageY+this.offset.y+3>=o&&(h=-this.offset.y-t),s+this._event.pageX+this.offset.x+3>=i&&(n=-this.offset.x-s),this.$el.css({top:this._event.pageY+h,left:this._event.pageX+n})},_onMouseMove:function(t){this._event=t},_onMouseEnter:function(){this._timer=setTimeout(this.show,this.delay)},_onMouseLeave:function(){this._timer&&clearTimeout(this._timer),this._shown&&this.hide()},remove:function(){this._shown&&this.hide(),this._timer&&clearTimeout(this._timer),this.$attachTo.undelegate(this.selector,"mousemove touchmove",this._onMouseMove),this.$attachTo.undelegate(this.selector,"mouseenter touchstart",this._onMouseEnter),this.$attachTo.undelegate(this.selector,"mouseleave touchend",this._onMouseLeave),o.View.prototype.remove.apply(this,arguments)}},{attachTo:function(t,e){var s=this;return e||(e={}),e.attachTo=t||"body",new s(e)},detachFrom:function(t){t=e(t)[0],t.tooltip&&t.tooltip.remove()}})});