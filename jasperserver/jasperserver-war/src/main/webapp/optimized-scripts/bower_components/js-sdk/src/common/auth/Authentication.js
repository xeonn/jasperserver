define(["require","jquery","underscore","json3","common/bi/component/ComponentEngine","common/bi/component/BiComponent","common/transport/request","common/bi/error/enum/biComponentErrorCodes","common/bi/error/biComponentErrorFactory","settings!auth","text!./Authentication.json"],function(o){function n(o){return o.token?(o.tokenName||p.ticketParameterName)+"="+o.token:"j_username="+o.name+"&j_password="+o.password+"&orgId="+(o.organization?o.organization:"null")+(o.locale?"&userLocale="+o.locale:"")+(o.timezone?"&userTimezone="+o.timezone:"")}var e=o("jquery"),t=o("underscore"),r=o("json3"),i=o("common/bi/component/ComponentEngine"),c=o("common/bi/component/BiComponent"),u=o("common/transport/request"),s=o("common/bi/error/enum/biComponentErrorCodes"),a=o("common/bi/error/biComponentErrorFactory"),p=o("settings!auth")||{ticketParameterName:"ticket"},m=o("text!./Authentication.json"),l={login:function(o,t){var i=e.Deferred();return t({url:o.url+(o.preAuth?"":"/j_spring_security_check")+"?"+n(o),headers:{Accept:"application/json"}}).done(function(o,n,e){var t=o;if("string"==typeof o)try{t=r.parse(o)}catch(c){i.reject(c)}t.success===!0?i.resolve(t):i.reject(e)}).fail(function(o){i.reject(o)}),i},logout:function(o,n){return n({url:o.url+"/logout.html"})}},f=function(o){var n=i.newInstance(m,o),e=this;n.decorateComponent(this,function(o,n){var e;e=o.properties&&o.properties.loginFn&&t.isFunction(o.properties.loginFn)?o.properties.loginFn:l.login,e(o.properties,u).done(function(e){o.data=!0,n.resolve(e)}).fail(function(o){n.reject(a.requestError(o,s.AUTHENTICATION_ERROR))})}),this.logout=function(o,e,r){var i,c=n.instanceData;return i=c.properties&&c.properties.logoutFn&&t.isFunction(c.properties.logoutFn)?c.properties.logoutFn:l.logout,i(c.properties,u).done(function(n){c.data=!1,o&&t.isFunction(o)&&o(n)}).fail(function(o){e&&t.isFunction(e)&&e(o)}).always(function(){r&&t.isFunction(r)&&r()})},this.login=function(o,n,t,r){return e.properties(o),e.run(n,t,r)}};return f.prototype=new c,f});