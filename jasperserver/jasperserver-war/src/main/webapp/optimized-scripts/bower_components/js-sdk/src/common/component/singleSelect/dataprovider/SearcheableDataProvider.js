define(["require","jquery","underscore"],function(e){var t=e("jquery"),i=e("underscore"),a=function(e){i.bindAll(this,"getData","_filterValues","_shouldFilter"),this.indexMapping={},this.internalGetData=e.getData};return i.extend(a.prototype,{getData:function(e){var i=new t.Deferred;if(e&&"undefined"!=typeof e.criteria)return this.dataCache=null,this.criteria=e.criteria,i.resolve(),i.promise();var a=this;return a._shouldFilter()?(this.dataCache?this._resolvePromise(e,i):this.internalGetData().done(function(t){a.indexMapping={},a.reverseIndexMapping={},a.dataCache=a._filterValues(t.data),a._resolvePromise(e,i)}).fail(i.reject),i.promise()):(this.indexMapping=null,this.reverseIndexMapping=null,this.dataCache=null,this.internalGetData(e))},getIndexMapping:function(){return this.indexMapping},getReverseIndexMapping:function(){return this.reverseIndexMapping},_resolvePromise:function(e,t){var i=e&&e.offset?e.offset:0,a=e&&e.limit?i+e.limit:this.dataCache.length,n=this._getDataSegment(this.dataCache,i,a);t.resolve({data:n,total:this.dataCache.length})},_shouldFilter:function(){return this.criteria},_filterValues:function(e){for(var t=[],i=0,a=0;a<e.length;a++){var n=e[a],r=void 0==n.label?n.value:n.label;r.toLowerCase().indexOf(this.criteria.toLowerCase())>-1&&(t[i]=n,this.indexMapping[i]=a,this.reverseIndexMapping[a]=i,i+=1)}return t},_getDataSegment:function(e,t,i){i=Math.min(i,e.length);for(var a=[],n=t;i>n;n++)a.push({label:e[n].label,value:e[n].value});return a}}),a});