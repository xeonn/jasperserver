define(["require","backbone","underscore","./OptionView"],function(t){"use strict";var e=t("backbone"),i=t("underscore"),n=t("./OptionView"),o=Array.prototype.slice;return e.View.extend({el:function(){return i.template(this.template)()},constructor:function(t){if(t||(t={}),!t.options||!t.options.length)throw new Error("Option views descriptors must be specified");if(!t.mainTemplate&&!t.el)throw new Error("Option container must have a template");if(!t.optionTemplate)throw new Error("Option container must have an option template");this.contextName=t.contextName||"option",this.contentContainer=t.el?t.contentContainer:t.contentContainer||"> .content > ul",this.toggle=!!t.toggle,this.toggleClass=t.toggleClass||"active",this.options=[],this.collection=new e.Collection(t.options),this.hasGroups=this.collection.models[0]&&this.collection.models[0].get("groupId")?!0:!1,this.defalutOptionView=this.hasGroups?this.collection.where({"default":!0}):[this.collection.findWhere({"default":!0})],this.listenTo(this.collection,"select",this._selectOption),this.template=t.mainTemplate,this.optionTemplate=t.optionTemplate,e.View.apply(this,arguments)},setElement:function(t){var i=e.View.prototype.setElement.apply(this,arguments);return this.$contentContainer=this.contentContainer?this.$(this.contentContainer):this.$el,i},initialize:function(){var t=this;this.collection.forEach(function(e){var i=new n({template:t.optionTemplate,model:e,toggleClass:t.toggleClass});t.listenTo(i,"mouseover",function(e,i){t.trigger("mouseover",e,t,i)}),t.listenTo(i,"mouseout",function(e,i){t.trigger("mouseout",e,t,i)}),t.options.push(i),t.$contentContainer.append(i.$el)}),this.toggle&&this.defalutOptionView&&i.each(this.defalutOptionView,function(t){t&&this.getOptionView(t.get("action")).addSelection()},this)},_onKeyDown:function(t){var e=this.getOptionView(t.keyCode,"triggerOnKeyCode");e&&!e.isDisabled()&&e.select()},_selectOption:function(t,e){if(this.toggle){var n=e.get("groupId"),o=this.hasGroups?i.where(this.options,function(t){return t.model.get("groupId")===n}):this.options;i.each(o,function(t){t.removeSelection()},this),t.addSelection()}this.trigger(this.contextName+":"+e.get("action"),t,e)},getOptionView:function(t,e){return i.find(this.options,function(i){return i.model.get(e||"action")===t})},resetSelection:function(t,e){t=t||[],this.toggle&&(this.hasGroups?(t.length<this.defalutOptionView.length&&i.each(this.defalutOptionView,function(e){var n={groupId:e.get("groupId")},o=i.findWhere(t,n);!o&&e&&t.push(i.extend(n,{action:e.get("action")}))}),t=i.pluck(t,"action")):!t.length&&this.defalutOptionView[0]&&t.push(this.defalutOptionView[0].get("action")),i.each(this.options,function(n){t.length&&(i.contains(t,n.model.get("action"))?e?this._selectOption(n,n.model):n.addSelection():n.removeSelection())},this))},select:function(t){var e=o.call(arguments);this.toggle&&i.each(this.options,function(t){!e.length||i.contains(e,t.model.get("action"))?t.addSelection():t.removeSelection()},this)},deselect:function(t){var e=o.call(arguments);this.toggle&&i.each(this.options,function(t){(!e.length||i.contains(e,t.model.get("action")))&&t.removeSelection()},this)},show:function(){return i.each(this.options,function(t){var e=t.model.get("test");e&&!e()?t.hide():t[t.model.get("hidden")?"hide":"show"]()}),this.$el.show(),this.trigger("show",this),this},hide:function(){return this.$el.hide(),this.trigger("hide",this),this},enable:function(t){var e=o.call(arguments);i.each(this.options,function(t){(!e.length||i.contains(e,t.model.get("action")))&&t.enable()})},disable:function(t){var e=o.call(arguments);i.each(this.options,function(t){(!e.length||i.contains(e,t.model.get("action")))&&t.disable()})},remove:function(){i.invoke(this.options,"remove"),e.View.prototype.remove.apply(this,arguments)}})});