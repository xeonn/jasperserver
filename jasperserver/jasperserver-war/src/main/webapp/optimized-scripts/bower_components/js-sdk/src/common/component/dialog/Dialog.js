define(["require","jquery.ui","underscore","jquery","./Dimmer","common/component/panel/Panel","common/component/option/OptionContainer","common/component/panel/trait/resizablePanelTrait","text!./template/dialogTemplate.htm","text!./template/dialogButtonTemplate.htm"],function(t){t("jquery.ui");var e=t("underscore"),i=t("jquery"),n=t("./Dimmer"),o=t("common/component/panel/Panel"),s=t("common/component/option/OptionContainer"),h=t("common/component/panel/trait/resizablePanelTrait"),r=t("text!./template/dialogTemplate.htm"),l=t("text!./template/dialogButtonTemplate.htm"),a=o.extend({defaultTemplate:r,events:{mousedown:"_focus",touchstart:"_focus",keydown:"_onKeyDown"},constructor:function(t){t||(t={}),t.traits||(t.traits=[]),this.resizable=t.resizable||!1,this.modal=t.modal||!1,this.resizable&&-1===e.indexOf(t.traits,h)&&t.traits.push(h),o.call(this,t)},initialize:function(t){this.collapsed=!this.collapsed,e.isEmpty(t.buttons)||(this.buttons=new s({options:t.buttons,el:this.$(".footer")[0],contextName:"button",optionTemplate:l})),o.prototype.initialize.apply(this,arguments),this.buttons&&this.listenTo(this.buttons,e.map(t.buttons,function(t){return"button:"+t.action}).join(" "),e.bind(function(t,e){this.trigger("button:"+e.get("action"),t,e)},this)),this.render()},setElement:function(){var t=o.prototype.setElement.apply(this,arguments);return this.buttons&&this.buttons.setElement(this.$(".footer")[0]),t},render:function(){return this.$el.hide(),this.modal&&(this.dimmer=new n({zIndex:900})),i("body").append(this.$el),this.$el.draggable({handle:".mover",addClasses:!1,containment:"document"}),this},open:function(t){return o.prototype.open.apply(this,arguments),this.modal&&this.dimmer.css({zIndex:++a.highestIndex}).show(),this._position(t)._increaseZIndex(),this.buttons&&this.buttons.$(".over").removeClass("over"),this.$el.show(),this.trigger("dialog:visible"),this},close:function(){return this.isVisible()?(this.$el.css({zIndex:--a.highestIndex}),this.modal&&this.dimmer.css({zIndex:--a.highestIndex}).hide(),this.$el.hide(),o.prototype.close.apply(this,arguments),this):void 0},toggleCollapsedState:function(){return this},enableButton:function(t){this.buttons.enable(t)},disableButton:function(t){this.buttons.disable(t)},isVisible:function(){return this.$el.is(":visible")},_position:function(t){var e,n,o=i("body"),s=this.$el.height(),h=this.$el.width();if(t&&"undefined"!=typeof t.top&&"undefined"!=typeof t.left){e=t.top,n=t.left;var r=o.height(),l=o.width(),a=r-t.top,u=l-t.left;s>a&&(e=t.top-s,e=0>e?r/2-s/2:e),h>u&&(n=t.left-h,n=0>n?l/2-h/2:n)}else e=i(window).height()/2-s/2,n=i(window).width()/2-h/2;return this.$el.css({top:e,left:n,position:"absolute"}),this},_focus:function(){!this.modal&&this._increaseZIndex()},_increaseZIndex:function(){this.$el.css({zIndex:++a.highestIndex})},_onKeyDown:function(t){this.buttons._onKeyDown(t)},remove:function(){this.buttons&&this.buttons.remove(),this.dimmer&&this.dimmer.remove();try{this.$el.draggable("destroy")}catch(t){}o.prototype.remove.call(this)}},{highestIndex:1e3,resetHighestIndex:function(t){a.highestIndex=t||1e3}});return a});