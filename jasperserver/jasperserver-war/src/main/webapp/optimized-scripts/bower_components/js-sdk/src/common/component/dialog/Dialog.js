define(["require","jquery.ui","css!common/dialog","underscore","jquery","../base/Dimmer","common/component/panel/Panel","common/component/base/OptionContainer","common/component/panel/trait/resizablePanelTrait","text!./template/dialogTemplate.htm","text!./template/dialogButtonTemplate.htm"],function(t){"use strict";t("jquery.ui"),t("css!common/dialog");var e=t("underscore"),i=t("jquery"),n=t("../base/Dimmer"),s=t("common/component/panel/Panel"),o=t("common/component/base/OptionContainer"),h=t("common/component/panel/trait/resizablePanelTrait"),a=t("text!./template/dialogTemplate.htm"),l=t("text!./template/dialogButtonTemplate.htm"),r={},d=s.extend({defaultTemplate:a,events:{mousedown:"_focus",touchstart:"_focus",keydown:"_onKeyDown"},constructor:function(t){t||(t={}),t.traits||(t.traits=[]),this.resizable=t.resizable||!1,this.modal=t.modal||!1,this.resizable&&-1===e.indexOf(t.traits,h)&&t.traits.push(h),s.call(this,t)},initialize:function(t){r=e.extend({},t),this.collapsed=!this.collapsed,e.isEmpty(t.buttons)||(this.buttons=new o({options:t.buttons,el:this.$(".m-Dialog-footer")[0]||this.$(".footer")[0],contextName:"button",optionTemplate:l})),s.prototype.initialize.apply(this,arguments),this.buttons&&this.listenTo(this.buttons,e.map(t.buttons,function(t){return"button:"+t.action}).join(" "),e.bind(function(t,e){this.trigger("button:"+e.get("action"),t,e)},this)),this.render()},setElement:function(t){var e=s.prototype.setElement.apply(this,arguments);return this.buttons&&this.buttons.setElement(this.$(".m-Dialog-footer")[0]||this.$(".footer")[0]),e},setTitle:function(t){this.$(".m-Dialog-header > .m-Dialog-header-title").text(t)},render:function(){return this.$el.hide(),this.modal&&(this.dimmer=new n({zIndex:900})),i("body").append(this.$el),this.$el.draggable({handle:".mover",addClasses:!1,containment:"document"}),this},open:function(t){return this.isVisible()?void 0:(s.prototype.open.apply(this,arguments),this.modal&&this.dimmer.css({zIndex:++d.highestIndex}).show(),r.additionalCssClasses&&-1!==r.additionalCssClasses.indexOf("newResizeableDialog")&&this._setMinSize(),this._position(t)._increaseZIndex(),this.buttons&&this.buttons.$(".over").removeClass("over"),this.$el.show(),this.trigger("dialog:visible"),this)},close:function(){return this.isVisible()?(this.$el.css({zIndex:--d.highestIndex}),this.modal&&this.dimmer.css({zIndex:--d.highestIndex}).hide(),this.$el.hide(),s.prototype.close.apply(this,arguments),this):void 0},addCssClasses:function(t){this.$el.addClass(t)},toggleCollapsedState:function(){return this},enableButton:function(t){this.buttons.enable(t)},disableButton:function(t){this.buttons.disable(t)},isVisible:function(){return this.$el.is(":visible")},_setMinSize:function(){r.minWidth&&this.$el.css({width:r.minWidth,minWidth:r.minWidth}),r.minHeight&&this.$el.css({height:r.minHeight,minHeight:r.minHeight})},_position:function(t){var e,n,s=i("body"),o=this.$el.height(),h=this.$el.width();if(t&&"undefined"!=typeof t.top&&"undefined"!=typeof t.left){e=t.top,n=t.left;var a=s.height(),l=s.width(),r=a-t.top,d=l-t.left;o>r&&(e=t.top-o,e=0>e?a/2-o/2:e),h>d&&(n=t.left-h,n=0>n?l/2-h/2:n)}else e=i(window).height()/2-o/2,n=i(window).width()/2-h/2;return this.$el.css({top:e,left:n,position:"absolute"}),this},_focus:function(){!this.modal&&this._increaseZIndex()},_increaseZIndex:function(){this.$el.css({zIndex:++d.highestIndex})},_onKeyDown:function(t){this.buttons._onKeyDown(t)},remove:function(){this.buttons&&this.buttons.remove(),this.dimmer&&this.dimmer.remove();try{this.$el.draggable("destroy")}catch(t){}s.prototype.remove.call(this)}},{highestIndex:1e3,resetHighestIndex:function(t){d.highestIndex=t||1e3}});return d});