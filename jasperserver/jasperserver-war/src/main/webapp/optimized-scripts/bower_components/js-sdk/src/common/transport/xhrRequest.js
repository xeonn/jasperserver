define(["require","jquery","underscore","logger"],function(e){function r(){a.trigger.apply(a,arguments)}function n(e){(401==e.status||e.getResponseHeader("LoginRequested"))&&(t(window).trigger("sessionExpired"),s.warn("Session timed-out. Redirecting to login page."),window.location.reload())}var t=e("jquery"),o=e("underscore"),s=e("logger").register("request");if("undefined"==typeof document)return{};var a=t(document);return function(e){return o.partial(r,"request:before").apply(null,arguments),t.ajax(e).fail(n).fail(function(e){e.getResponseHeader("adhocException")?s.error(e.getResponseHeader("adhocException")):(500==e.status||e.getResponseHeader("JasperServerError")&&!e.getResponseHeader("SuppressError"))&&s.error(e.responseText)}).fail(o.partial(r,"request:failure")).done(o.partial(r,"request:success"))}});