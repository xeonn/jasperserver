define(["require","common/component/tree/Tree","jquery","underscore","json3","common/component/tree/TreeDataLayer","common/component/tree/plugin/TooltipPlugin","common/component/tree/plugin/ContextMenuTreePlugin","bi/repo/enum/repositoryResourceTypes","text!bi/repo/dialog/RepositoryChooserDialog/template/repositoryFoldersTreeLevelTemplate.htm","bundle!CommonBundle","settings/generalSettings"],function(e){"use strict";function o(e){var o=2;return e.isWritable&&(o=4|o),e.isRemovable&&(o=16|o),e.isAdministrable&&(o=1),o}var t=e("common/component/tree/Tree"),r=e("jquery"),n=e("underscore"),i=e("json3"),s=e("common/component/tree/TreeDataLayer"),l=e("common/component/tree/plugin/TooltipPlugin"),a=(e("common/component/tree/plugin/ContextMenuTreePlugin"),e("bi/repo/enum/repositoryResourceTypes")),u=e("text!bi/repo/dialog/RepositoryChooserDialog/template/repositoryFoldersTreeLevelTemplate.htm"),c=e("bundle!CommonBundle"),p=e("settings/generalSettings"),m={folderTreeProcessor:{processItem:function(e){return e._node=!0,e._readonly=!(1==e.value.permissionMask||4&e.value.permissionMask),e}},filterPublicFolderProcessor:{processItem:function(e){return e.value.uri!==d.settings.publicFolderUri&&e.value.uri!==d.settings.tempFolderUri?e:void 0}},i18n:{processItem:function(e){return e.i18n=c,e}},tenantProcessor:{processItem:function(e){return e._node=!0,e.value.label=e.value.tenantName,e.value.uri=e.value.tenantUri,e}}},d=function(e){return t.use(l,{i18n:c,contentTemplate:e.tooltipContentTemplate}).create().instance({additionalCssClasses:"folders",dataUriTemplate:e.contextPath+"/rest_v2/resources?{{= id != '@fakeRoot' ? 'folderUri=' + id : ''}}&recursive=false&type="+a.FOLDER+"&offset={{= offset }}&limit={{= limit }}",levelDataId:"uri",itemsTemplate:u,collapsed:!0,lazyLoad:!0,rootless:!0,selection:{allowed:!0,multiple:!1},customDataLayers:{"/":n.extend(new s({dataUriTemplate:e.contextPath+"/flow.html?_flowId=searchFlow&method=getNode&provider=repositoryExplorerTreeFoldersProvider&uri=/&depth=1",processors:n.chain(m).omit("filterPublicFolderProcessor","tenantProcessor").values().value(),getDataArray:function(e){e=i.parse(r(e).text());var t=n.find(e.children,function(e){return"/public"===e.uri}),s=[{id:"@fakeRoot",label:e.label,uri:"/",resourceType:"folder",permissionMask:o(e.extra),_links:{content:"@fakeContentLink"}}];return t&&s.push({id:"/public",label:t.label,uri:"/public",resourceType:"folder",permissionMask:o(t.extra),_links:{content:"@fakeContentLink"}}),s}}),{accept:"text/html",dataType:"text"})},processors:[m.i18n,m.folderTreeProcessor,m.filterPublicFolderProcessor],getDataArray:function(e,o,t){return e?e[a.RESOURCE_LOOKUP]:[]}})};return d.settings=p,d});