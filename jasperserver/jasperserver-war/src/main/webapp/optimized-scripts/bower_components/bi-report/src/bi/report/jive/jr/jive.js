define(["common/jquery/extension/timepickerExt","text!jr.jive.templates.tmpl","csslink!jr.jive.vm.css","text!jr.jive.i18n.tmpl"],function(e,t,o,i){var n="click";/Android|iPhone|iPad/i.test(navigator.userAgent)&&(n="touchend");var s={name:"jive",reportInstance:null,active:!1,started:!1,selectors:{},elements:{},interactive:{},clickEventName:n,isIE:/msie/i.test(navigator.userAgent),isIPad:/ipad/i.test(navigator.userAgent),isFloatingHeader:!1,isDashboard:!1,activeContainer:null,getReportContainer:function(){return this.activeContainer},jivei18n:JSON.parse(i),i18n:{get:function(e){return s.jivei18n.hasOwnProperty(e)?s.jivei18n[e]:e}},ui:{scaleFactor:1,marker:{jo:null,position:null,createElement:function(){var t=e("<div/>",{id:"jive_marker"}).css({display:"none"}),o=e("<div/>",{id:"jive_marker_icon"}),i=e("<div/>").css({position:"absolute",top:0,right:"6px",bottom:0,left:"-6px"});s.$jiveComponents.append(t.append(o).append(i))},setElement:function(t){e(t).length&&this.createElement(),this.jo=e(t),this.jo.draggable({axis:"x",start:function(){s.ui.overlay.left=s.ui.overlay.jo.position().left,s.resizingColumn=!0},drag:function(e,t){s.ui.overlay.jo.width(t.position.left-s.ui.overlay.left)},stop:function(e,t){s.interactive[s.selected.ie.config.type].resize((t.position.left-s.ui.overlay.left)/(s.reportInstance.zoom?s.reportInstance.zoom.level:s.ui.scaleFactor?s.ui.scaleFactor:1)),s.resizingColumn=!1}})},show:function(e){var t=!1;this.jo&&!this.jo.parent().length&&delete this.jo,this.jo||(this.setElement("#jive_marker"),t=!0),this.jo.css({height:e.h}),this.jo.appendTo(s.getReportContainer()).show(),this.jo.position({of:s.ui.overlay.jo,my:"left top",at:"right top",collision:"none"}),t&&this.jo.position({of:s.ui.overlay.jo,my:"left top",at:"right top",collision:"none"});var o=this.jo.get(0).style.left,i=this.jo.get(0).style.top,n=o.indexOf("px");n>0&&(o=o.substring(0,n)),n=i.indexOf("px"),n>0&&(i=i.substring(0,n)),this.position={left:o,top:i}},remove:function(){if(this.jo){try{this.jo.draggable("destroy")}catch(e){}this.jo.remove(),this.jo=null}}},overlay:{jo:null,left:null,createElement:function(){var t=e("<div/>",{id:"jive_drag_label"}).css({background:"#eee",border:"solid 1px #555",padding:"8px",display:"none"}),o=e("<div/>",{id:"jive_overlay"}).css({display:"none"}).append("<div/>");s.$jiveComponents.append(o).append(t)},setElement:function(t){e(t).length&&this.createElement(),this.jo=e(t),this.jo.draggable({cursorAt:{top:40,left:-30},start:function(e,t){s.hide(["foobar","marker"]),s.interactive[s.selected.ie.config.type].onDragStart(e,t)},drag:function(e,t){s.interactive[s.selected.ie.config.type].onDrag(e,t)},stop:function(e,t){s.interactive[s.selected.ie.config.type].onDragStop(e,t),s.hide()}})},show:function(t){var o=!1;this.jo&&!this.jo.parent().length&&delete this.jo,this.jo||(this.setElement("#jive_overlay"),o=!0),this.jo.css({width:t.w*(t.zoom?t.zoom:1),height:t.h}).draggable("option","helper",function(){return e("div.jive_drag_label").clone().appendTo("#jive_components").html(s.i18n.get("column.move.helper")).show()}),this.jo.appendTo(s.getReportContainer()).show(),this.jo.position({of:s.selected.jo,my:"left top",at:"left top",collision:"none"}),o&&this.jo.position({of:s.selected.jo,my:"left top",at:"left top",collision:"none"})},remove:function(){if(this.jo){try{this.jo.draggable("destroy")}catch(t){}this.jo.remove(),e("div.jive_drag_label").remove(),this.jo=null}}},foobar:{jo:null,current:null,dropMenu:null,cache:{},menus:{},createElement:function(){var t=e("<div/>",{id:"jive_foobar"}).css({display:"none"});s.$jiveComponents.append(t)},setElement:function(t){e(t).length&&this.createElement(),this.jo=e(t),this.jo.on("mousedown touchstart","button",function(){var t=e(this);return!t.hasClass("disabled")&&t.addClass("pressed"),!1}),this.jo.on("mouseup touchend","button",function(){var t=e(this);t.removeClass("pressed");var o=s.selected.ie.config.type,i=t.attr("fn");if(!s.resizingColumn)if(i&&!t.hasClass("disabled"))s.interactive[o][i](s.interactive[o].actions[t.attr("actionkey")].arg);else if(t.attr("menu")){var n=s.ui.foobar.menus[o][t.attr("menu")];n.jo.show().position({of:e(this),my:"left top+2",at:"left bottom",collision:"none"}),s.ui.foobar.dropMenu=n}return!1}),this.jo.on("mouseover","button",function(){s.ui.foobar.dropMenu&&s.ui.foobar.dropMenu.jo.hide();var t=e(this);if(!t.hasClass("disabled")&&t.addClass("over"),t.attr("menu")){var o=s.ui.foobar.menus[s.selected.ie.config.type][t.attr("menu")];o.jo.show().position({of:e(this),my:"left top+2",at:"left bottom",collision:"none"}),s.ui.foobar.dropMenu=o}}),this.jo.on("mouseout","button",function(){e(this).removeClass("over pressed")}),this.cache={},this.menus={},this.current=null},show:function(){this.jo&&!this.jo.parent().length&&delete this.jo,!this.jo&&this.setElement("#jive_foobar"),this.render(s.interactive[s.selected.ie.config.type].actions),this.jo.find("button").removeClass("over pressed"),this.jo.appendTo(s.getReportContainer()).show(),this.setToolbarPosition(),this.setToolbarPosition()},setToolbarPosition:function(){var t,o=s.selected.jo.offset().top-this.jo.outerHeight();t=s.isDashboard?e(window).scrollTop():e("div#reportViewFrame .body").length>0?e("div#reportViewFrame .body").offset().top:0;var i=this.jo.outerHeight(),n=s.ui.overlay.jo.offset().top-s.getReportContainer().offset().top,a=i>=n?i:0;this.jo.css({position:"absolute"}),this.jo.offset({top:o+a,left:s.selected.jo.offset().left}),this.topCalculated=!1,s.isFloatingHeader?s.setToolbarPositionWhenFloating(!0,s.isDashboard):t>=o&&this.jo.offset({top:s.selected.jo.offset().top})},render:function(t){var o=this,i=['<button class="jive_foobar_button" title="',,'" actionkey="',,'" ',,'><span class="wrap"><span class="icon ',,'"></span></span></button>'];if(!o.cache[s.selected.ie.config.type]){o.cache[s.selected.ie.config.type]="";e.each(t,function(e,t){t.actions&&(o.menus[s.selected.ie.config.type]=o.menus[s.selected.ie.config.type]||{},o.createMenu(e,t.label,t.actions)),i[1]=t.title,i[3]=e,i[5]=t.fn?'fn="'+t.fn+'"':t.actions?'menu="'+e+'"':"",i[7]=t.icon,o.cache[s.selected.ie.config.type]+=i.join("")})}o.current!=s.selected.ie.config.type&&(o.jo.empty(),o.jo.html(o.cache[s.selected.ie.config.type]),o.current=s.selected.ie.config.type)},createMenu:function(t,o,i){var n=this,a='<ul class="pmenu" label="'+t+'">';e.each(i,function(e,t){if(!t.disabled){var o=t.fn?'fn="'+t.fn+'"':"",i=t.label||e;o+=t.arg?" data-args='"+t.arg+"'":"",a+='<li class="pmenuitem" key="'+e+'" '+o+">"+i+"</li>",t.actions&&n.createMenu(e,t.label,t.actions)}}),a+="</ul>",n.menus[s.selected.ie.config.type][t]={jo:e(a).appendTo("#jive_menus")}},reset:function(){this.cache={},this.menus={}},remove:function(){this.jo&&(this.jo.off().remove(),this.dropMenu&&this.dropMenu.jo.remove(),this.jo=null,this.reset())}},dialog:{jo:null,body:null,isVisible:!1,setElement:function(t){var o,i,a=this;a.jo=e(t),a.jo.draggable({handle:"div.dialogHeader"}),a.body=a.jo.find("div.dialogBody"),a.title=a.jo.find("span.dialogTitle"),a.tabs=a.jo.find("div.tabContainer"),"function"==typeof isIE&&isIE()&&navigator.appVersion.indexOf("MSIE 10.0;")<0&&a.jo.prepend('<div class="msshadow" />'),a.tabs.on(n,".tab",function(){var t,o=e(this);o.hasClass("disabled")||(a.tabs.find(".tab").removeClass("active"),o.addClass("active"),s.selected.form.onBlur(),s.selected.form.jo.hide(),t=s.selected.form.actionDataCache,s.selected.form=s.ui.forms[o.data("form")],e.extend(s.selected.form.actionDataCache,t),s.selected.form.onShow(),s.selected.form.jo.show(),e("body")[0].style.zoom=0==e("body")[0].style.zoom?1:0)}),a.body.on(n,"input, select",function(){var t=e(this);t.focus(),"radio"==t.attr("type")&&t.trigger("change").prop("checked",!0)}),a.body.on("change",".jive_listTextInput, .jive_listTextInputTouch",function(){var t=e(this);s.selected.form.inputs[t.next("select").attr("name")].value=""!==t.val()?t.val():null}),a.body.on("change","select.wFreeText",function(){var t=e(this);t.prev().val(t.val()),s.selected.form.inputs[t.attr("name")].value=t.val()}),a.body.on("keypress",".jive_restrictedInput",function(t){return"numeric"===e(this).data("restriction")&&isNaN(String.fromCharCode(t.which))?!1:!0}),a.body.on(n,".jive_inputbutton",function(){switch(o=e(this),i=s.selected.form.inputs[o.attr("bname")],o.attr("type")){case"radio":i.set(o.attr("value"),o);break;case"checkbox":i.toggle()}i.onClick&&i.onClick(o)}),a.body.on(n,".jive_freeTextButton",function(){o=e(this),o.parent().next().find("input, select").toggle()}),e("#dialogOk, #dialogCancel").bind(n,function(){this.className.indexOf("disabled")<0&&("dialogCancel"==this.id?(s.active=!1,e("body").trigger("jive.inactive")):s.selected.form.submit(),s.ui.dialog.hide(),s.ui.dialog.isVisible=!1)})},show:function(t,o,i){if(!this.jo&&this.setElement("#jive_dialog"),o.length>1){var n,a,l="",r=i||0;e.each(o,function(e,t){n=s.ui.forms[t],a=e==r?"active":"",l+='<div id="'+n.name+'Tab" data-form="'+n.name+'" class="tab dialog '+a+'"><span>'+n.title+"</span></div>",!n.jo&&s.ui.forms.render(n),s.ui.dialog.body.append(n.jo)}),this.tabs.html(l).show(),s.selected.form=s.ui.forms[o[r]]}else this.tabs.hide(),s.selected.form=s.ui.forms[o[0]],!s.selected.form.jo&&s.ui.forms.render(s.selected.form),this.body.append(s.selected.form.jo);s.selected.form.onShow(),this.title.html(t),s.selected.form.jo.show(),this.jo.show().position({of:e(window),at:"center center",my:"center center",collision:"none fit"}),this.isVisible=!0,s.hide(null,!0)},hide:function(){var t=this,o=[];s.ui.dialog.jo.hide(),t.body.children().each(function(){o.push(this.id.substring(10)),e(this).appendTo("#jive_forms").hide()}),e("#jive_dropdown .pmenu").hide(),e.each(o,function(e,t){s.ui.forms[t].onHide&&s.ui.forms[t].onHide()})},toggleButtons:function(){e("#dialogOk, #dialogCancel").toggleClass("disabled")},remove:function(){this.jo&&(this.body.off(),this.tabs.off(),this.jo&&this.jo.remove(),this.jo=null,e("#dialogOk, #dialogCancel").unbind(),s.ui.dialog.isVisible=!1)}},forms:{add:function(e){s.ui.forms[e.name]=e},render:function(t){var o=s.ui.forms,i="display:none;width:700px;",n=e('<form id="jive_form_'+t.name+'" action="" method="'+t.method+'" class="jive_form" style="'+i+'"/>').appendTo("#jive_forms"),a=[];t.inputs={},e.each(t.elements,function(o,i){a.push('<table width="100%">'),e.each(i,function(o,i){a.push("<tr>"),e.each(i,function(e,o){s.ui.forms.createElement(o,t,n,a)}),a.push("</tr>")}),a.push("</table>")}),n.append(a.join("")),o[t.name].jo=n,o[t.name].onCreate(n)},createElement:function(t,o,i,n){var a,l=t.label||"",r=t.colspan?' colspan="'+t.colspan+'"':"",c=t.rowspan?' rowspan="'+t.rowspan+'"':"",d=t.tdClass?" "+t.tdClass:"",u=t.tdWidth?"width: "+t.tdWidth+";":"",p=t.isHeader?"th":"td",h=t.align?"text-align: "+t.align+";":"",f=t.width?" width: "+t.width+"px;":"",v=t.wrapClass||"";if(n.push("<"+p+" "),"label"==t.type&&(a=t.value||"",n.push('class="jive_textLabel'+d+'" style="'+u+'"'+r+">"),n.push(t.nowrap?a:'<div class="'+v+'" style="'+h+f+'">'+a+"</div>")),"text"==t.type&&(n.push('class="'+d+'" style="'+u+'"'+r+c+">"),t.label&&n.push('<div class="wrapper label">'+t.label+":</div>"),n.push('<div class="wrapper"><input id="'+t.id+'" type="text" name="'+t.id+'" value="'+t.value+'"/></div>'),o.inputs[t.id]={set:function(o){e("#"+t.id).val(o)},get:function(){return e("#"+t.id).val()}}),"radio"==t.type&&(n.push('class="'+d+'" style="'+u+'"'+r+c+'><div class="thick wrapper"><input type="radio" id="'+t.id+t.value+'" name="'+t.id+'" value="'+t.value+'"/><label for="'+t.id+t.value+'" class="jive_inputLabel">'+l+"</label></div>"),o.inputs[t.id]={set:function(o){e('input[name="'+t.id+'"]').val(o)},get:function(){return e('input[name="'+t.id+'"]').val()}}),"list"==t.type){var m=t.size?t.size:1,b="ontouchstart"in document.documentElement?"Touch":"",g="ontouchstart"in document.documentElement||1==m?"":"showList",j=t.freeText?"wFreeText":"",y=null!=t.restriction,w=['<select id="'+t.id+'" name="'+t.id+'" class="'+g+" "+j+'" size="'+m+'">'];e.each(t.values,function(e,t){w.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),t.groups&&e.each(t.groups,function(t,o){w.push('<optgroup label="'+o.name+'">'),e.each(o.values,function(e,t){w.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),w.push("</optgroup>")}),w.push("</select>"),n.push('class="'+d+'" style="'+u+'"'+r+c+">"),t.label&&n.push('<div class="wrapper label">'+t.label+":</div>"),n.push('<div class="wrapper">'),t.freeText&&n.push('<input id="'+t.id+'Text" type="text" class="'+(y?"jive_restrictedInput ":"")+"jive_listTextInput"+b+'" name="'+t.id+'Text" value=""'+(y?' data-restriction="'+t.restriction+'"':"")+"/>"),n.push(w.join("")),n.push("</div>"),o.inputs[t.id]={value:null,set:function(o){this.value=o,e("#"+t.id).val(o),t.freeText&&e("#"+t.id+"Text").val(o)},get:function(){return this.value}}}"button"==t.type&&(n.push('class="'+d+'" style="'+u+'">'),n.push('<div class="jive_inputbutton'+(t.btnClass?"  "+t.btnClass:"")+'" bname="'+t.id+'">'),t.bIcon&&n.push('<span class="jive_bIcon '+t.bIcon+'"></span>'),t.bLabel&&n.push(t.nowrap?t.bLabel:'<span class="jive_bLabel">'+t.bLabel+"</span>"),n.push("</div>"),o.inputs[t.id]={onClick:function(e){s.ui.forms[o.name][t.fn](e)}}),"buttons"==t.type&&(n.push('class="'+d+'" style="'+u+'"'+r+c+">"),l.length>0&&n.push('<div class="wrapper label">'+l+":</div>"),n.push('<div class="wrapper"><div class="buttonbar">'),e.each(t.items,function(t,a){!o.inputs[a.id]&&i.append('<input type="hidden" name="'+a.id+'" value="" />'),n.push('<div class="jive_inputbutton '+(a.btnClass?" "+a.btnClass:"")+(a.drop?" drop":"")+'" bname="'+a.id+'" value="'+a.value+'" type="'+a.type+'">'),("color"===a.type||"backcolor"===a.type)&&n.push('<div class="colorpick'+(a.styleClass?" "+a.styleClass:" normal")+'"></div>'),a.bIcon&&n.push('<span class="jive_bIcon '+a.bIcon+'"></span>'),a.bLabel&&n.push('<span class="jive_bLabel">'+a.bLabel+"</span>"),n.push("</div>"),"dropdown"===a.type&&(o.inputs[a.id]={_idd:a.id,_options:a.options,onClick:function(){s.interactive[s.selected.ie.config.type][a.fn]()},showOptions:function(){var t=e("#jive_dropdown");t.empty();var o='<ul class="pmenu">';e.each(this._options,function(e,t){o+="<li class='pmenuitem' data-args='{\"val\":\""+t.value+"\"}' fn='"+t.fn+"'>"+t.label+"</li>"}),o+="</ul>",t.append(o),t.find(".pmenu").show(),t.css({width:"150px",height:"100px"}),t.position({my:"left top-10",at:"left bottom",of:e('div.jive_inputbutton[bname="'+this._idd+'"]'),collision:"none"})},hideOptions:function(){e("#jive_dropdown .pmenu").hide()}}),"checkbox"==a.type&&(o.inputs[a.id]={value:null,set:function(t){var o=e('div.jive_inputbutton[bname="'+a.id+'"]');this.value=t,t===!0?o.removeClass("unchanged").addClass("selected"):t===!1?o.removeClass("unchanged").removeClass("selected"):null===t&&(a.isTripleState?o.removeClass("selected").addClass("unchanged"):this.set(!1))},toggle:function(){this.value===!0?this.set(!1):this.value===!1?this.set(a.isTripleState?null:!0):a.isTripleState&&null===this.value&&this.set(!0)},get:function(){return this.value},onClick:function(){a.fn&&s.interactive[s.selected.ie.config.type][a.fn]()}}),"radio"!=a.type||o.inputs[a.id]||(o.inputs[a.id]={value:null,set:function(t,o){return o&&o.is(".selected")&&a.isTripleState?void this.set(null):(this.value=t,e('div.jive_inputbutton[bname="'+a.id+'"]').removeClass("selected"),void e('div.jive_inputbutton[bname="'+a.id+'"][value="'+t+'"]').addClass("selected"))},get:function(){return this.value},onClick:function(){a.fn&&s.interactive[s.selected.ie.config.type][a.fn]()}}),"action"==a.type&&(o.inputs[a.id]={onClick:function(){s.interactive[s.selected.ie.config.type][a.fn]()}}),"color"==a.type&&(o.inputs[a.id]={value:null,set:function(t){var o=e('div.jive_inputbutton[bname="'+a.id+'"]');this.value=t,null===t?o.addClass("unchanged").find("div.colorpick").css("background-color","transparent"):"null"===t?this.set(null):o.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"===t?t:"#"+t)},get:function(){return this.value},onClick:function(t){s.ui.colorpicker.show({title:a.title,inputId:a.id,anchor:t,currentColor:e('input[name="'+a.id+'"]').val(),showTransparent:a.showTransparent,showReset:a.showReset})}}),"backcolor"==a.type&&(o.inputs[a.id]={backColor:null,modeValue:null,set:function(t,o,i){var n=e('div.jive_inputbutton[bname="'+a.id+'"]');i?"keep_existing"!==t&&(this.backColor="null"===t?null:t):this.backColor=t,this.modeValue="null"===o?null:o,this.backColor||this.modeValue?"Transparent"!==this.modeValue&&this.backColor?this.backColor&&n.removeClass("unchanged").find("div.colorpick").css("background-color","#"+this.backColor):n.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"):n.addClass("unchanged").find("div.colorpick").css("background-color","transparent")},getBackColor:function(){return this.backColor},getModeValue:function(){return this.modeValue},onClick:function(t){s.ui.colorpicker.show({title:a.title,inputId:a.id,anchor:t,currentColor:e('input[name="'+a.id+'"]').val(),showTransparent:a.showTransparent,showReset:a.showReset})}})}),n.push("</div></div>")),n.push("</"+p+">")},createTemplateElement:function(t,o,i,n){var a=t.label||"",l=t.colspan?'colspan="'+t.colspan+'"':"",r=t.rowspan?'rowspan="'+t.rowspan+'"':"",c=i.find("*[id^="+t.id+"]").size(),d=t.id+(c>0?"_"+e.now():""),u=t.tdClass?" "+t.tdClass:"",p=t.align?"text-align: "+t.align+";":"",h=t.width?" width: "+t.width+"px;":"",f=t.wrapClass||"";if("label"==t.type&&(n.push('<td class="jive_textLabel'+u+'" '+l+">"),n.push(t.nowrap?t.value:'<div class="'+f+'" style="'+p+h+'">'+t.value+"</div>"),n.push("</td>")),"text"==t.type&&(n.push('<td class="'+u+'" '+l+" "+r+">"),t.label&&n.push('<div class="'+f+'">'+t.label+":</div>"),n.push('<div class="'+f+'"><input id="'+d+'" type="text" name="'+t.id+'" value="'+t.value+'"/></div></td>'),o.inputs[d]={set:function(t){e("#"+d).val(t)},get:function(){return e("#"+d).val()}}),"list"==t.type){var v=t.size?t.size:1,m="ontouchstart"in document.documentElement?"Touch":"",b="ontouchstart"in document.documentElement||1==v?"":"showList",g=t.freeText?"wFreeText":"",j=null!=t.restriction,y=['<select id="'+d+'" name="'+t.id+'" class="'+b+" "+g+'" size="'+v+'">'];e.each(t.values,function(e,t){y.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),t.groups&&e.each(t.groups,function(t,o){y.push('<optgroup label="'+o.name+'">'),e.each(o.values,function(e,t){y.push('<option value="'+t[0]+'">'+t[1]+"</option>")}),y.push("</optgroup>")}),y.push("</select>"),n.push('<td class="'+u+'" '+l+" "+r+">"),t.label&&n.push('<div class="'+f+'">'+t.label+":</div>"),n.push('<div class="'+f+'">'),t.freeText&&n.push('<input id="'+d+'Text" type="text" class="'+(j?"jive_restrictedInput ":"")+"jive_listTextInput"+m+'" name="'+t.id+'Text" value=""'+(j?' data-restriction="'+t.restriction+'"':"")+"/>"),n.push(y.join("")),n.push("</div></td>"),o.inputs[d]={set:function(o){e("#"+d).val(o),t.freeText&&e("#"+d+"Text").val(o)},get:function(){return t.freeText?e("#"+d+"Text").val():e("#"+d).val()}}}"button"==t.type&&(n.push('<td class="'+u+'">'),n.push('<div class="jive_inputbutton'+(t.btnClass?"  "+t.btnClass:"")+'" bname="'+t.id+'">'),t.bIcon&&n.push('<span class="jive_bIcon '+t.bIcon+'"></span>'),t.bLabel&&n.push(t.nowrap?t.bLabel:'<span class="jive_bLabel">'+t.bLabel+"</span>"),n.push("</div>"),n.push("</td>"),o.inputs[t.id]={onClick:function(e){s.ui.forms[o.name][t.fn](e)}}),"buttons"==t.type&&(n.push('<td class="'+u+'" '+l+" "+r+">"),a.length>0&&n.push('<div class="'+f+'">'+a+":</div>"),n.push('<div class="'+f+'"><div class="buttonbar">'),e.each(t.items,function(t,a){var l=i.find("*[bname^="+a.id+"]").size(),r=a.id+(l>0?"_"+e.now():"");n.push('<div class="jive_inputbutton '+(a.btnClass?" "+a.btnClass:"")+(a.drop?" drop":"")+'" bname="'+r+'" value="'+a.value+'" type="'+a.type+'">'),("color"===a.type||"backcolor"===a.type)&&n.push('<div class="colorpick'+(a.styleClass?" "+a.styleClass:" normal")+'"></div>'),a.bIcon&&n.push('<span class="jive_bIcon '+a.bIcon+'"></span>'),a.bLabel&&n.push('<span class="jive_bLabel">'+a.bLabel+"</span>"),n.push("</div>"),"checkbox"==a.type&&(o.inputs[r]={value:null,set:function(t){var o=e('div.jive_inputbutton[bname="'+r+'"]');this.value=t,t===!0?o.removeClass("unchanged").addClass("selected"):t===!1?o.removeClass("unchanged").removeClass("selected"):null===t&&(a.isTripleState?o.removeClass("selected").addClass("unchanged"):this.set(!1))},toggle:function(){this.value===!0?this.set(!1):this.value===!1?this.set(a.isTripleState?null:!0):a.isTripleState&&null===this.value&&this.set(!0)},get:function(){return this.value},onClick:function(){a.fn&&s.interactive[s.selected.ie.config.type][a.fn]()}}),"action"==a.type&&(o.inputs[r]={onClick:function(e){s.ui.forms[o.name][a.fn](e)}}),"color"==a.type&&(o.inputs[r]={value:null,set:function(t){var o=e('div.jive_inputbutton[bname="'+r+'"]');this.value=t,null===t?o.addClass("unchanged").find("div.colorpick").css("background-color","transparent"):"null"===t?this.set(null):o.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"===t?t:"#"+t)},get:function(){return this.value},onClick:function(t){s.ui.colorpicker.show({title:a.title,inputId:r,anchor:t,currentColor:e('input[name="'+r+'"]').val(),showTransparent:a.showTransparent,showReset:a.showReset})}}),"backcolor"==a.type&&(o.inputs[r]={backColor:null,modeValue:null,set:function(t,o,i){var n=e('div.jive_inputbutton[bname="'+r+'"]');i?"keep_existing"!==t&&(this.backColor="null"===t?null:t):this.backColor=t,this.modeValue="null"===o?null:o,this.backColor||this.modeValue?"Transparent"!==this.modeValue&&this.backColor?this.backColor&&n.removeClass("unchanged").find("div.colorpick").css("background-color","#"+this.backColor):n.removeClass("unchanged").find("div.colorpick").css("background-color","transparent"):n.addClass("unchanged").find("div.colorpick").css("background-color","transparent")},getBackColor:function(){return this.backColor},getModeValue:function(){return this.modeValue},onClick:function(t){s.ui.colorpicker.show({title:a.title,inputId:r,anchor:t,currentColor:e('input[name="'+r+'"]').val(),showTransparent:a.showTransparent,showReset:a.showReset})}})}),n.push("</div></div></td>"))},remove:function(){var t=s.ui.forms;e.each(t,function(e){var o=t[e];o.name&&o.remove()})}},colorpicker:{jo:null,selected:null,title:"",inputId:null,setElement:function(){var t=this;t.jo=e("#jive_colorpicker"),t.jo.draggable({handle:"div.dialogHeader"}),t.jo.on(n,"div.pick",function(o){t.selected=e(this).parent().addClass("selected"),s.selected.form.inputs[t.inputId].set(t.extractHexColor(t.selected.children().eq(0).attr("hexcolor")),t.selected.closest("tr").data("mode"),!0),s.ui.colorpicker.jo.hide(),s.ui.modal.hide(),o.preventDefault()})},show:function(e){this.title=e.title||"Pick a color",this.inputId=e.inputId,!this.jo&&this.setElement(),this.jo.find("td.selected").removeClass("selected"),e.currentColor&&this.jo.find("div.pick[hexcolor="+e.currentColor+"]").parent().addClass("selected"),e.showTransparent?this.jo.find("tr.transparent_pick").show():this.jo.find("tr.transparent_pick").hide(),e.showReset?this.jo.find("tr.reset_pick").show():this.jo.find("tr.reset_pick").hide(),s.ui.modal.show(this.jo),this.jo.find("h2").html(this.title),this.jo.show().position({of:e.anchor,at:"left bottom",my:"left top",offset:"0 0",collision:"none"})},extractHexColor:function(e){if(e&&-1!==e.toLowerCase().indexOf("rgb")){var t,o,i,n="",s=e.split(",");for(t=0;t<s.length;t++)o=parseInt(/\d+/.exec(s[t])[0],10),i=o.toString(16),n+=1===i.length?"0"+i:i;return n}return e},remove:function(){if(this.jo){try{this.jo.draggable("destroy")}catch(e){}this.jo.off().remove(),this.jo=null}}},modal:{whf:null,visible:!1,show:function(t){this.whf=t,e("#jive_modal").length||(this.jo=e("<div/>",{id:"#jive_modal"}).css({display:"none",position:"absolute",zIndex:9999,top:0,bottom:0,left:0,right:0}),s.getReportContainer().append(this.jo),this.jo.on(n,function(e){s.ui.modal.hide(),e.preventDefault()})),this.visible||(s.ui.dialog.toggleButtons(),this.jo.show(),this.visible=!0)},hide:function(){s.ui.modal.whf.hide(),s.ui.dialog.toggleButtons(),this.jo.hide(),this.visible=!1},remove:function(){this.jo&&(this.jo.off().remove(),this.visible=!1,this.whf=null)}}},selected:{ie:null,jo:null,form:null},viewerReady:!1,encodeHTML:function(t){return e("<div/>").text(t).html()},decodeHTML:function(t){return e("<div/>").html(t).text()},escapeFontName:function(e){return e?e.replace(/"/g,""):null},hide:function(t,o){var i=this;t?e.each(t,function(e,t){i.ui[t].jo&&i.ui[t].jo.hide()}):(o?i.active=i.ui.dialog.isVisible:(i.active=!1,i.ui.dialog.isVisible&&i.ui.dialog.hide()),i.ui.marker.jo&&i.ui.marker.jo.appendTo("#jive_components").hide(),i.ui.overlay.jo&&i.ui.overlay.jo.appendTo("#jive_components").hide(),i.ui.foobar.jo&&i.ui.foobar.jo.appendTo("#jive_components").hide(),e(".pmenu").hide(),i.ui.colorpicker.jo&&i.ui.colorpicker.jo.hide())},getHeaderTable:function(){var t=e("table.floatableHeader");if(0==t.length){t=e("<table class='floatableHeader' style='display:none'/>").appendTo("div#reportContainer"),t.on(n,".jrcolHeader",function(o){if(!e(o.target).parent().is("a")){var i=e(this),n=i.data("coluuid"),a=t.parent().find("table.jrPage td.jrcolHeader[data-coluuid="+n+"]:first");return a.length&&s.selectInteractiveElement(a),!1}});var o,i,a,l,r,c,d,u,p,h,f,v,m=e("td.jrcolHeader:first"),b=m.closest("table"),g=e("td.jrcolHeader:last",b),j=[],y=[];if(m.length>0){if(m.addClass("first_jrcolHeader"),i=m.closest("tr"),a=g.closest("tr"),f=m.closest("table"),i===a)j.push(i);else for(v=b.find("tr"),d=v.index(i),u=v.index(a),p=d;u>=p;p++)j.push(v.get(p));e.each(j,function(i,n){for(c=e(n).find("td"),o=e("<tr></tr>"),y[i]=0,d=0,h=c.length;h>d;d++)r=e(c.get(d)),l=r.clone(),y[i]=y[i]+r.outerWidth(),l.width(r.width()),l.height(r.height()),o.append(l);t.append(o)}),t.css({position:"fixed",width:Math.max.apply(Math,y),"empty-cells":f.css("empty-cells"),"border-collapse":f.css("border-collapse"),"background-color":f.css("background-color")}),t.attr("cellpadding",f.attr("cellpadding")),t.attr("cellspacing",f.attr("cellspacing")),t.attr("border",f.attr("border"))}}return t},setToolbarPositionWhenFloating:function(t,o){var i,n,s,a,l=this;t&&(n=e("td.first_jrcolHeader"),i=o?0:e("div#reportViewFrame .body").offset().top,s=l.ui.foobar.jo.offset().top,a=n.offset().top,l.ui.foobar.topCalculated?l.ui.foobar.jo.css({left:l.selected.jo.offset().left-e(window).scrollLeft()}):(0>s?0>a&&s>a&&(i+=Math.abs(s-a)):0>a?i+=Math.abs(a)+s:s>a&&(i+=s-a),l.ui.foobar.jo.css({position:"fixed",top:i,left:l.selected.jo.offset().left-e(window).scrollLeft()}),l.ui.foobar.topCalculated=!0))},applyScaleTransform:function(e,t,o){var i="scale("+t+")",o=o||"50% 0",n={"-webkit-transform":i,"-webkit-transform-origin":o,"-moz-transform":i,"-moz-transform-origin":o,"-ms-transform":i,"-ms-transform-origin":o,"-o-transform":i,"-o-transform-origin":o,transform:i,"transform-origin":o};e.css(n)},zoom:function(){var e=this;e.isFloatingHeader&&e.scrollHeader(e.isDashboard,!0),e.active&&e.hide()},scrollHeader:function(t,o){var i=this,n=e(window),a=e("div#reportViewFrame .body"),l=!1,r=!1;if(null!=i.scrollData.scrollTop?a.scrollTop()!=i.scrollData.scrollTop&&(i.scrollData.scrollTop=a.scrollTop(),l=!0):0!=a.scrollTop()&&(i.scrollData.scrollTop=a.scrollTop(),l=!0),null!=i.scrollData.scrollLeft?a.scrollLeft()!=i.scrollData.scrollLeft&&(i.scrollData.scrollLeft=a.scrollLeft(),r=!0):0!=a.scrollLeft()&&(i.scrollData.scrollLeft=a.scrollLeft(),r=!0),r||l||o){var c=e("td.jrcolHeader:first");if(!(!c.length>0)){var d=i.getHeaderTable(),u=c.closest("table"),p=t?n.scrollTop():e("div#reportViewFrame .body").offset().top,h=c.closest("tr").offset().top,f=e("#reportContainer").offset().top,v=e("td.first_jrcolHeader:first").closest("table").find("td.jrcel:last"),m=v.length?v.offset().top-d.outerHeight()-p:-1,b=i.cachedScroll||0,g=s.reportInstance.zoom;i.isIPad&&!i.cachedHeaderTop&&(i.cachedHeaderTop=h),!t&&i.isIPad&&(b+=i.cachedHeaderTop-h),!i.scrollData.bMoved&&0>h-p&&m>0?(d.show(),g?(i.applyScaleTransform(d,g.level,g.overflow?"0 0":"50% 0"),d.offset({top:t?i.isIPad?b:0:i.isIPad?b:p,left:u.offset().left}),d.offset({top:t?i.isIPad?b:0:i.isIPad?b:p,left:u.offset().left})):d.offset({top:t?i.isIPad?b:0:i.isIPad?b:p,left:u.offset().left}),i.setToolbarPositionWhenFloating(i.active,t),i.scrollData.bMoved=i.isFloatingHeader=!0,t||i.scrollData.reportContainerPositionAtMove||(i.scrollData.reportContainerPositionAtMove=f)):i.scrollData.bMoved&&0>h-p&&m>0?(d.show(),g?(i.applyScaleTransform(d,g.level,g.overflow?"0 0":"50% 0"),d.offset({top:t?i.isIPad?b:0:i.isIPad?b:p,left:u.offset().left})):r&&d.offset({top:t?i.isIPad?b:0:i.isIPad?b:p,left:u.offset().left}),i.setToolbarPositionWhenFloating(i.active,t)):i.scrollData.bMoved&&(d.hide(),i.scrollData.bMoved=i.isFloatingHeader=!1,i.cachedScroll=0,i.active&&i.ui.foobar.setToolbarPosition()),i.isIPad&&(i.cachedHeaderTop=h),i.isIPad&&(i.cachedScroll=b)}}},setScrollableHeader:function(t){var o=this;o.scrollData={bMoved:!1,reportContainerPositionAtMove:null},t||e("div#reportViewFrame .body").on("scroll",function(){o.scrollHeader(t)}),o.isIE&&e("body").on("scroll",function(){o.scrollHeader(t),o.active&&!o.ui.dialog.isVisible&&o.showVisualElements(s.selected.dim)}),e(window).on("resize scroll",function(){o.scrollHeader(t),o.active&&!o.ui.dialog.isVisible&&o.showVisualElements(s.selected.dim)})},init:function(t){s.reportInstance=t,s.elements[t.id]={},s.selectors[t.id]={},!e("#jive_components").length&&this.createJiveElements()},createJiveElements:function(){s.isDashboard=e("body").is(".dashboardViewFrame"),(s.isDashboard||e("div#reportViewFrame").length>0)&&s.setScrollableHeader(s.isDashboard),s.$jiveComponents=e("<div/>",{id:"jive_components"}).attr("data-reportId",s.reportInstance.id),e("body").append(s.$jiveComponents),s.$jiveComponents.empty(),s.$jiveComponents.append(t),s.reportInstance.config.container.on(n,function(){s.ui.dialog.isVisible||(s.hide(),e("body").trigger("jive.inactive"))});var o;this.$menus=e("div#jive_menus, div#jive_dropdown"),this.$menus.on({"mouseup touchend":function(t){o=e(this);var i=o.data("args");if(o.attr("fn")&&s.interactive[s.selected.ie.config.type][o.attr("fn")](i),"touchend"==t.type){var n=o.attr("key");s.ui.foobar.menus[s.selected.ie.config.type][n]?s.ui.foobar.menus[s.selected.ie.config.type][n].jo.show().position({of:o,my:"left top",at:"right top"}):!s.ui.dialog.isVisible&&s.hide()}t.preventDefault()},mouseover:function(){o=e(this),o.addClass("hover"),o.width()<o.parent().width()-24&&o.width(o.parent().width()-24),o.parent().prevAll().hide();var t=o.attr("key");s.ui.foobar.menus[s.selected.ie.config.type][t]&&s.ui.foobar.menus[s.selected.ie.config.type][t].jo.show().position({of:o,my:"left top",at:"right top"})},mouseout:function(){o=e(this),o.removeClass("hover")}},".pmenuitem"),e("div#jive_dropdown").on({"mouseup touchend":function(t){var o=e(this).data("args");e(this).attr("fn")&&s.interactive[s.selected.ie.config.type][e(this).attr("fn")](o),t.preventDefault()}},".pmenuitem"),e("div#jive_dropdown").on("mouseleave",".pmenu",function(){e(this).hide()}),e("body").trigger("jive.initialized",[s])},initInteractiveElement:function(t,o,i){s.elements[o][t.config.id]&&(e.hasData(i.find("table.jrPage")[0])||(s.selectors[o]={})),s.elements[o][t.config.id]=t,s.selectors[o][t.config.parentId+"-"+t.config.selector]||(s.selectors[o][t.config.parentId+"-"+t.config.selector]=t.config.type,i.find("table.jrPage").on(n,t.config.selector,function(t){var i=e(t.target).parent();if(!i.is("a")&&!i.hasClass("_jrHyperLink")){var n=e(this);return!e("#jive_components").length&&s.createJiveElements(),s.selectInteractiveElement(n,o),!1}})),t.config.proxySelector&&!s.selectors[o][t.config.parentId+"-"+t.config.proxySelector]&&(s.selectors[o][t.config.parentId+"-"+t.config.proxySelector]=t.config.type,i.find("table.jrPage").on(n,t.config.proxySelector,function(i){var n=e(i.target).parent();
if(!n.is("a")&&!n.hasClass("_jrHyperLink")){var a=s.interactive[t.config.type].getInteractiveElementFromProxy(e(this));return s.selectInteractiveElement(a,o),!1}}))},selectInteractiveElement:function(t,o){if(t&&t.is(".interactiveElement")){s.ui.dialog.isVisible&&s.ui.dialog.hide(),s.activeContainer=t.closest("._jr_report_container_"),s.$jiveComponents.attr("data-reportId",o);var i=s.interactive.column.columnsData[o][t.data("tableuuid")][t.data("coluuid")];s.selected={ie:s.elements[o][t.data("coluuid")],jo:s.interactive.column.getJoForCurrentSelection(t),realWidth:i.width,realHeight:i.height};var n,a,l=s.activeContainer.find("table.jrPage .jrcolHeader[data-coluuid="+t.data("coluuid")+"]"),r=l.eq(0),c=r.offset().left;n=a=r.outerWidth(),l.each(function(t,o){var i=e(o);i.offset().left<c&&(a+=c-i.offset().left,c=i.offset().left),i.offset().left+i.outerWidth()>c+a&&(a=i.offset().left+i.outerWidth()-c,n+=i.outerWidth())}),s.selected.realWidth=n,s.selected.dim=s.interactive[s.selected.ie.config.type].getElementSize();for(var d=s.selected.ie;d.parent&&(d=d.parent)&&!d.zoom;);s&&s.ui&&s.ui.scaleFactor?s.selected.dim.zoom=s.ui.scaleFactor:d.zoom&&(s.selected.dim.zoom=d.zoom.level),this.showVisualElements(s.selected.dim),s.active=!0,s.started=!0,s.interactive[s.selected.ie.config.type].onSelect()}},scale:function(e){s.ui.scaleFactor=e,s.selected&&s.selected.dim&&(s.selected.dim.zoom=e)},showVisualElements:function(e){s.ui.overlay.show(e),s.ui.marker.show(e),s.ui.foobar.show(e),s.ui.foobar.dropMenu&&s.ui.foobar.dropMenu.jo.hide()},remove:function(e){s.$jiveComponents.attr("data-reportId")===e.id&&(s.$menus.off(),s.ui.dialog.remove(),s.ui.marker.remove(),s.ui.overlay.remove(),s.ui.foobar.remove(),s.ui.forms.remove(),s.ui.colorpicker.remove(),s.ui.modal.remove(),s.$jiveComponents.remove())}};return s});