define(["require","jquery","underscore","common/util/parse/number","common/util/parse/date","common/util/parse/time","common/jquery/extension/timepickerExt"],function(e){var t=e("jquery"),r=e("underscore"),i=e("common/util/parse/number"),a=e("common/util/parse/date"),n=e("common/util/parse/time");e("common/jquery/extension/timepickerExt");var o={jQueryUiTimestampToIsoTimestamp:function(e,r){if(r&&r.calendarPatterns){var i=r.calendarPatterns.date,n=r.calendarPatterns.time;return a.dateObjectToIso8601Timestamp(t.datepicker.parseDateTime(i,n,e))}return void 0},jQueryUiTimeToIsoTime:function(e,r){if(r&&r.calendarPatterns){var i=r.calendarPatterns.time,a=t.datepicker.parseTime(i,e);if(a)return n.timeToIso8061Time(a.hour,a.minute,a.second)}return void 0},isoTimestampTojQueryUiTimestamp:function(e,r){if(r&&r.calendarPatterns){var i=a.iso8601TimestampToDateObject(e),n=r.calendarPatterns.date,o=r.calendarPatterns.time,m=t.timepicker&&t.timepicker._defaults&&t.timepicker._defaults.separator?t.timepicker._defaults.separator:" ",_=t.datepicker.formatDate(n,i),T=t.datepicker.formatTime(o,{hour:i.getHours(),minute:i.getMinutes(),second:i.getSeconds()});return _+m+T}return void 0},isoTimeTojQueryUiTime:function(e,r){if(r&&r.calendarPatterns){var i=n.iso8601TimeToTimeObject(e),a=r.calendarPatterns.time;if(i)return t.datepicker.formatTime(a,{hour:i.hours,minute:i.minutes,second:i.seconds})}return void 0},filterStartValue:function(e,t,a,n){var m=null==t&&null==e,_="boolean"===a,T="numeric"===a,u="datetime"===a,s="time"===a;return m?"":r.isArray(t)?u?o.isoTimestampTojQueryUiTimestamp(t[0],n):s?o.isoTimeTojQueryUiTime(t[0],n):T?i.formatNumber(t[0]):t[0]:_?"":u?o.isoTimestampTojQueryUiTimestamp(t,n):s?o.isoTimeTojQueryUiTime(t,n):T?i.formatNumber(t):t},filterEndValue:function(e,t,a,n){var m=null==t&&null==e,_="numeric"===a,T="datetime"===a,u="time"===a;return m?"":r.isArray(t)?T?o.isoTimestampTojQueryUiTimestamp(t[1],n):u?o.isoTimeTojQueryUiTime(t[1],n):_?i.formatNumber(t[1]):t[1]:""},dataTypeToSchemaFormat:{Text:"string",Numeric:"numeric",Date:"datetime",Boolean:"boolean",Time:"time"},schemaFormatOperatorToFilterOperatorMap:function(){var e={};return e.string={},e.string.equal="EQUALS",e.string.not_equal="IS_NOT_EQUAL_TO",e.string.contain="CONTAINS",e.string.not_contain="DOES_NOT_CONTAIN",e.string.start_with="STARTS_WITH",e.string.not_start_with="DOES_NOT_START_WITH",e.string.end_with="ENDS_WITH",e.string.not_end_with="DOES_NOT_END_WITH",e.datetime={},e.datetime.equal="EQUALS",e.datetime.not_equal="IS_NOT_EQUAL_TO",e.datetime.between="IS_BETWEEN",e.datetime.not_between="IS_NOT_BETWEEN",e.datetime.on_or_before="IS_ON_OR_BEFORE",e.datetime.before="IS_BEFORE",e.datetime.on_or_after="IS_ON_OR_AFTER",e.datetime.after="IS_AFTER",e.time={},e.time.equal="EQUALS",e.time.not_equal="IS_NOT_EQUAL_TO",e.time.between="IS_BETWEEN",e.time.not_between="IS_NOT_BETWEEN",e.time.on_or_before="IS_ON_OR_BEFORE",e.time.before="IS_BEFORE",e.time.on_or_after="IS_ON_OR_AFTER",e.time.after="IS_AFTER",e.numeric={},e.numeric.equal="EQUALS",e.numeric.not_equal="DOES_NOT_EQUAL",e.numeric.greater="GREATER_THAN",e.numeric.greater_or_equal="GREATER_THAN_EQUAL_TO",e.numeric.less="LESS_THAN",e.numeric.less_or_equal="LESS_THAN_EQUAL_TO",e.numeric.between="IS_BETWEEN",e.numeric.not_between="IS_NOT_BETWEEN",e}(),filterOperatorToSchemaFormatMap:function(){var e={};return e.string={},e.string.EQUALS="equal",e.string.IS_NOT_EQUAL_TO="not_equal",e.string.CONTAINS="contain",e.string.DOES_NOT_CONTAIN="not_contain",e.string.STARTS_WITH="start_with",e.string.DOES_NOT_START_WITH="not_start_with",e.string.ENDS_WITH="end_with",e.string.DOES_NOT_END_WITH="not_end_with",e.datetime={},e.datetime.EQUALS="equal",e.datetime.IS_NOT_EQUAL_TO="not_equal",e.datetime.IS_BETWEEN="between",e.datetime.IS_NOT_BETWEEN="not_between",e.datetime.IS_ON_OR_BEFORE="on_or_before",e.datetime.IS_BEFORE="before",e.datetime.IS_ON_OR_AFTER="on_or_after",e.datetime.IS_AFTER="after",e.numeric={},e.numeric.EQUALS="equal",e.numeric.DOES_NOT_EQUAL="not_equal",e.numeric.GREATER_THAN="greater",e.numeric.GREATER_THAN_EQUAL_TO="greater_or_equal",e.numeric.LESS_THAN="less",e.numeric.LESS_THAN_EQUAL_TO="less_or_equal",e.numeric.IS_BETWEEN="between",e.numeric.IS_NOT_BETWEEN="not_between",e.time={},e.time.EQUALS="equal",e.time.IS_NOT_EQUAL_TO="not_equal",e.time.IS_BETWEEN="between",e.time.IS_NOT_BETWEEN="not_between",e.time.IS_ON_OR_BEFORE="on_or_before",e.time.IS_BEFORE="before",e.time.IS_ON_OR_AFTER="on_or_after",e.time.IS_AFTER="after",e}(),schemaFormatOperatorToFilterOperator:function(e,t,r){return"boolean"!==r?o.schemaFormatOperatorToFilterOperatorMap[r][e]:"equal"===e&&t===!0?"IS_TRUE":"equal"===e&&t===!1?"IS_FALSE":"not_equal"===e&&t===!0?"IS_NOT_TRUE":"not_equal"===e&&t===!1?"IS_NOT_FALSE":void 0},operatorAndValueToSchemaFormat:function(e,t,r,a){var n={};if("boolean"===t)"IS_TRUE"===e?(n.operator="equal",n.value=!0):"IS_FALSE"===e?(n.operator="equal",n.value=!1):"IS_NOT_TRUE"===e?(n.operator="not_equal",n.value=!0):"IS_NOT_FALSE"===e&&(n.operator="not_equal",n.value=!1);else if(n.operator=o.filterOperatorToSchemaFormatMap[t][e],"string"===t)n.value=r;else if("numeric"===t)try{n.value="between"===n.operator||"not_between"===n.operator?[i.parseNumber(r),i.parseNumber(a)]:i.parseNumber(r)}catch(m){throw new Error("Cannot convert filter value to number",m)}else"datetime"===t?n.value="between"===n.operator||"not_between"===n.operator?[o.jQueryUiTimestampToIsoTimestamp(r,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0),o.jQueryUiTimestampToIsoTimestamp(a,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0)]:o.jQueryUiTimestampToIsoTimestamp(r,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0):"time"===t&&(n.value="between"===n.operator||"not_between"===n.operator?[o.jQueryUiTimeToIsoTime(r,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0),o.jQueryUiTimeToIsoTime(a,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0)]:o.jQueryUiTimeToIsoTime(r,this.parent&&this.parent.config?this.parent.config.genericProperties:void 0));return n}};return o});