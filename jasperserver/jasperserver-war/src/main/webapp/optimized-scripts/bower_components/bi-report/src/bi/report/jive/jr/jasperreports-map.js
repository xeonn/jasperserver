define(["require"],function(o){var n=function(o,n){this.config=o,this.parent=null,this.loader=null,this.$reportEl=n,this.infowindow={},this._init()};return n.prototype={_init:function(){var n=this,e=n.config.instanceData,i=e.requestParams||"";"undefined"==typeof google||"undefined"!=typeof google&&"undefined"==typeof google.maps?o(["async!http://maps.google.com/maps/api/js?sensor=false"+i+"!callback"],function(){n._showMap(n.config.id,e.latitude,e.longitude,e.zoom,e.mapType,e.markerList,e.pathsList)}):n._showMap(n.config.id,e.latitude,e.longitude,e.zoom,e.mapType,e.markerList,e.pathsList)},_configureImage:function(o,n,e){var i,t,a,l,r,p;i=n[o+".width"]?parseInt(n[o+".width"]):null,t=n[o+".height"]?parseInt(n[o+".height"]):null,a=n[o+".origin.x"]?parseInt(n[o+".origin.x"]):0,l=n[o+".origin.y"]?parseInt(n[o+".origin.y"]):0,r=n[o+".anchor.x"]?parseInt(n[o+".anchor.x"]):0,p=n[o+".anchor.y"]?parseInt(n[o+".anchor.y"]):0,e[o]={url:n[o+".url"],size:i&&t?new google.maps.Size(i,t):null,origin:new google.maps.Point(a,l),anchor:new google.maps.Point(r,p)}},_createInfo:function(o){if(o["infowindow.content"]&&o["infowindow.content"].length>0){var n=google.maps,e={content:o["infowindow.content"]};return o["infowindow.pixelOffset"]&&(e.pixelOffset=o["infowindow.pixelOffset"]),o["infowindow.latitude"]&&o["infowindow.longitude"]&&(e.position=new n.LatLng(o["infowindow.latitude"],o["infowindow.longitude"])),o["infowindow.maxWidth"]&&(e.maxWidth=o["infowindow.maxWidth"]),new n.InfoWindow(e)}return null},_showMap:function(o,n,e,i,t,a,l){var r=this,p=google.maps,s={zoom:i,center:new p.LatLng(n,e),mapTypeId:p.MapTypeId[t],autocloseinfo:!0},g=new p.Map(r.$reportEl.find("#"+o)[0],s);if(a)for(var f,c=0;c<a.length;c++){var h=a[c],d=new p.LatLng(h.latitude,h.longitude),w={position:d,map:g};h["icon.url"]&&h["icon.url"].length>0?r._configureImage("icon",h,w):h.icon&&h.icon.length>0?w.icon=h.icon:h.color&&h.color.length>0?w.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+(h.label&&h.label.length>0?h.label:"%E2%80%A2")+"%7C"+h.color:h.label&&h.label.length>0&&(w.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+h.label+"%7CFE7569"),h["shadow.url"]&&h["shadow.url"].length>0&&r._configureImage("shadow",h,w);for(f in h)f.indexOf(".")<0&&h.hasOwnProperty(f)&&!w.hasOwnProperty(f)&&(w[f]=h[f]);var u=new google.maps.Marker(w);u.info=r._createInfo(h),p.event.addListener(u,"click",function(){g.autocloseinfo&&r.infowindow&&r.infowindow.close&&r.infowindow.close(),this.info?(r.infowindow=this.info,this.info.open(g,this)):this.url&&this.url.length>0&&window.open(this.url,this.target)})}if(l)for(var m=0;m<l.length;m++){var _=l[m],y={},v=[],I=!1;for(prop in _)if("locations"===prop&&_[prop])for(var L=_[prop],f=0;f<L.length;f++){var b=L[f];v.push(new google.maps.LatLng(b.latitude,b.longitude))}else"isPolygon"===prop?I=r._getBooleanValue(_[prop]):y[prop]="visible"===prop||"editable"===prop||"clickable"===prop||"draggable"===prop||"geodesic"===prop?r._getBooleanValue(_[prop]):_[prop];y.map=g,I?(y.paths=v,new google.maps.Polygon(y)):(y.path=v,new google.maps.Polyline(y))}},_getBooleanValue:function(o){return o===!0||"true"===o}},n});