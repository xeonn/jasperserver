!function(e,a){"function"==typeof define&&define.amd?define(["underscore"],e):a.AdhocDataProcessor=e(_)}(function(e){var a={debug:!1,fn:{getMessage:function(e){return this.messages?this.messages[e]:e},load:function(e){var r=a;r.data=e.data,r.metadata=e.metadata,r.treeNodeAxes=e.treeNodes,r.fn.load_common(),a.debug&&(console.info("Data Processor State:"),console.info(r))},load_common:function(){var e=a;if(e.measureAxis=e.metadata.measureAxis,e.nonMeasureAxis=0==e.measureAxis?1:0,e.metadata.axes.length&&(e.measureLevelNumber=e.fn.getMeasureLevelNumber.call(e),e.metadata.isOLAP&&(e.measureDimensionNumber=0,e.dimensionMappings=[],e.dimensionAllMappings=new Array(2),e.dimensionLevels=new Array(2),e.rowDimensionMapping=e.fn.dimensionMapping(0),e.dimensionMappings.push(e.rowDimensionMapping),e.colDimensionMapping=e.fn.dimensionMapping(1),e.dimensionMappings.push(e.colDimensionMapping)),e.lastRowNonMeasureLevel=0,e.lastColumnNonMeasureLevel=0,e.rowSliderLevelCount=e.metadata.axes[0].length+1-(0==e.metadata.measureAxis?1:0),e.colSliderLevelCount=e.metadata.axes[1].length+1-(1==e.metadata.measureAxis?1:0),e.rowGroupMapping=e.fn.groupMapping.call(e,0),e.colGroupMapping=e.fn.groupMapping.call(e,1)),e.treeNodeAxes.length&&(e.fn.createTreeNodeStructure.call(e,e.treeNodeAxes[0]),e.fn.createTreeNodeStructure.call(e,e.treeNodeAxes[1])),e.data.length){if("undefined"==typeof e.measureAxis)throw"AdhocDataProcessor.load_common  missing measureAxis metadata !";if(e.measureAxis>1)throw"AdhocDataProcessor.load_common  measureAxis > 1 !";if(e.measureAxis<0)throw"AdhocDataProcessor.load_common  measureAxis < 0 !";if("undefined"==typeof e.measureLevelNumber)throw"AdhocDataProcessor.load_common  measureLevelNumber undetermined !";if(e.measureLevelNumber<=0)throw"AdhocDataProcessor.load_common  measureLevelNumber <= 0 !"}},getOLAPDimensionInfo:function(){for(var e=a,r=new Array(2),n=0;2>n;n++){var t=[],o=e.dimensionMappings[n],s=e.measureAxis===n;if(o.length<=0);else for(var l=e.dimensionAllMappings[n],i=0;i<o.length;i++){var u=o[i];if(!(s&&u.length>0&&"Measures"===u[0].dimension)){var d=!1;l[i]===!0&&(d=!0);var m={};m.levels=[];var v=0;d&&m.levels.push({label:"(All)",levelName:"(All)",levelNumber:v}),v=1;for(var f=0;f<u.length;f++){var g=u[f];m.dimension=g.dimension,g.name&&"(All)"===g.name||(m.levels.push({label:g.label,levelName:g.name,levelNumber:v}),v++)}t.push(m)}}r[n]=t}return a.debug&&(console.log("AdhocDataProcessor.getOLAPDimensionInfo: 4098h  olapAxes"),console.log(r)),r},getMeasureLevelNumber:function(){for(var e=this.metadata.axes[this.metadata.measureAxis],a=0;a<e.length;a++)if("Measures"==e[a].label)return a+1},groupMapping:function(e){var r,n=a,t=[0],o=1,s=n.metadata.axes[e];for(r=0;r<s.length;r++)"Measures"!=s[r].label&&(t[o++]=r+1);return t},dimensionMapping:function(e){var r=a;if(!r.metadata.isOLAP)return null;var n=r.metadata.axes[e],t=1,o=[],s=[];if(r.metadata.axes[e].length<=0)return o;var l=0,i=!1,u=n[0].dimension,d=u;u||alert("dataprocessor.js  ERROR ! 0983jhrn   null dimension in axis "+e);for(var m=[],v=[],f=[],g=t,L=0;L<n.length;L++)if(d=n[L].dimension,"Measures"===d&&(r.measureDimensionNumber=l,r.measureLevelNumber=t),d!==u&&(s.push(i?!0:!1),f.push({dimension:u,startLevel:g,endLevel:t-1}),o.push(m),l++,m=[],i=!1,u=d,g=t),"(All)"!==n[L].label&&"(ALL)"!==n[L].label||(i=!0,!(L<n.length-1&&d===n[L+1].dimension))){var c={dimension:n[L].dimension,label:n[L].label,name:n[L].name,levelNumber:t};m.push(c),v.push(c),t++}return s.push(i?!0:!1),o.push(m),f.push({dimension:d,startLevel:g,endLevel:t-1}),r.metadata.axes[e]=v,r.dimensionAllMappings[e]=s,r.dimensionLevels[e]=f,a.debug&&(console.log("AdhocDataProcessor.dimensionMapping:49e8h  dimensions for axis "+e),console.log(o)),o},createTreeNodeStructure:function(e){var a=e;a.parent=null,a.children?this.fn.connectParentNode.call(this,a,a.children):a.children=[]},connectParentNode:function(e,a){var r,n;for(r=0;r<a.length;r++)if(n=a[r],n.parent=e,n.children){var t=n.children;t.length&&this.fn.connectParentNode.call(this,n,t)}else n.children=[]},getDataStyle:function(){var e=a;return 0==e.metadata.axes[e.nonMeasureAxis].length?0:e.metadata.axes[e.nonMeasureAxis].length>0&&e.metadata.axes[e.measureAxis].length>1?2:1},getNodeListForSliderLevel:function(e,r){var n=a,t=n.metadata.axes[e].length,o=[];o.push({startLevel:0,endLevel:r,leafLevel:t});var s=n.fn.getNodeListForDimLevels(e,o);return a.debug&&(console.log("AdhocDataProcessor.getNodeListForSliderLevel: 4088h  nodeList for axisIndex="+e+" sliderLevel="+r),console.log(s)),s},getNodeListForDimLevelRadio:function(e,r){var n=a;if(!n.metadata.isOLAP)throw"dataprocessor.getNodeListForDimLevelRadio called RadioButton method for non-OLAP query !";if(null===r)throw"dataprocessor.getNodeListForDimLevelRadio.js  y5g59i8y  NULL radioLevel input !";var t=n.dimensionMappings[e];if(!t)throw"dataprocessor.getNodeListForDimLevelRadio.js 0oi098  no dimensionMappings for axis "+e;if(t.length<=0)return n.fn.getEmptyAxisResult();if(r.length>t.length)throw"dataprocessor.getNodeListForDimLevelRadio.js  98hu for axis: "+e+", number of input dimensionss from radio buttons: "+r.length+", exceeds the number of dimensions in the chart data: "+t.length;if(r.length+(e==n.metadata.measureAxis?1:0)<t.length){a.debug&&console.log("AdhocDataProcessor.getNodeListForDimLevelRadio.js need to add  Radio Dimensions padding");for(var o=r.length,s=o;s<t.length;s++){var l=t[s];"Measures"!==l.dimension&&r.push({level:l.length})}}var i=[],u=(n.metadata.axes[e],t.length,0),d=0,m=!1,v=t[0],f="Measures"===v[0].dimension,g=0;if(f&&(g=1),f&&0==r.length)i.push({startLevel:0,endLevel:1,leafLevel:1});else for(var L=0;L<r.length;L++){var l=t[L+g];if(null===l)throw"dataprocessor.getNodeListForDimLevelRadio.js 98hn8 metadata  no dimension for number "+L;if(u++,n.metadata.measureAxis===e&&0>=g){if(L+2>t.length)throw"dataprocessor.getNodeListForDimLevelRadio.js  43098h  we were expecting dimensions to be at least "+(L+2)+" in length, instead it is "+t.length;var c=t[L+1];"Measures"===c[0].dimension&&(m=!0,g=1)}var h=l.length,p=d,A=d+r[L].level,N=d+h;(f||m)&&((A===N||f)&&A++,N++,f=!1,m=!1),i.push({startLevel:p,endLevel:A,leafLevel:N}),d=N}var x=n.fn.getNodeListForDimLevels(e,i);return a.debug&&(console.log("AdhocDataProcessor.getNodeListForDimLevelRadio: 39uh  nodeList for axis="+e+" radioDims, dimLevels "),console.log(r),console.log(i),console.log(x)),x},getNodeListForDimLevels:function(e,r){var n=a;if(0==n.metadata.axes[0].length&&0==n.metadata.axes[1].length)return null;var t=n.metadata.axes[e].length;if(t>0){var o=n.fn.getNodeListForDimensionLevelsMeasure(e,r);return o}return n.fn.getEmptyAxisResult()},getNodeListForSliderLevelGroupMeasure:function(e,r){var n=a,t=n.metadata.axes[e].length;if(t>0){var o=[];return o.push({startLevel:0,endLevel:r,leafLevel:t}),n.fn.getNodeListForDimensionLevelsMeasure(e,o)}return n.fn.getEmptyAxisResult()},getEmptyAxisResult:function(){var e=a;if(!e.emptyAxisResult){var r={isAll:!1,label:"(empty axis)",level:0,axisCoordinate:0};e.emptyAxisResult=[],e.emptyAxisResult.push(r)}return e.emptyAxisResult},getNodeListForDimensionLevelsMeasure:function(e,r){var n=a,t=!1;e===n.metadata.measureAxis&&(t=!0);var o=0==e?n.rowGroupMapping:n.colGroupMapping,s=n.treeNodeAxes[e],l=[];l.push(s);for(var i=0;i<r.length;i++){var u=r[i].startLevel,d=r[i].endLevel,m=r[i].leafLevel;a.debug&&console.log("AdhocDataProcessor.getNodeListForDimensionLevelsMeasure: 93287h  begin qualifying nodes for dim="+i+" startlevel="+u+", endLevel="+d+"localLeafLevel="+m);var v=!1;n.metadata.isOLAP?d===m&&(v=!0):i>=r.length-1&&(0==e?d>=n.rowSliderLevelCount-1&&(v=!0):d>=n.colSliderLevelCount-1&&(v=!0));var f=[];if(v){var g=m;n.metadata.isOLAP||i===r.length-1&&(g=n.metadata.axes[e].length),n.fn.getNodeListForActualLevel(e,l,g,f),a.debug&&(console.log("AdhocDataProcessor.getNodeListForDimensionLevelsMeasure: we9iuhf  LeafLevel nodeList for targetLevel="+g),console.log(f));var L=[],c=0;n.metadata.isOLAP&&(c=u);for(var h=0;h<f.length;h++){var p=f[h];if(p.isAll!==!0)for(var A=p.parent;null!=A;){if(A.level<=c){L.push(p);break}if(A.isAll===!0)break;A=A.parent}}l=L,a.debug&&(console.log("AdhocDataProcessor.getNodeListForDimensionLevelsMeasure:  er83   qualifiedChildren"),console.log(l))}else{var g=o[d+1];n.metadata.isOLAP&&(g=d+1),1==r.length&&0==g?f.push(s):l&&n.fn.getNodeListForActualLevel(e,l,g,f);for(var N=[],h=0;h<f.length;h++){var p=f[h],x=!1;if(p.level<=0)throw"dataprocessor.getNodeListForDimensionLevelsMeasure  leaf  node.level is unexpectedly less or equal to zero !";if(0!=p.level&&p.isAll===!0&&(x=!0),x){if(!p.parent)throw"AdhocDataProcessor.getNodeListForDimensionLevelsMeasure Unexpected missing node.parent in axis "+e;var b=p.parent;if(t&&p.parent.level==n.measureLevelNumber&&n.measureLevelNumber>1){if(!p.parent.parent)throw"AdhocDataProcessor.getNodeListForDimensionLevelsMeasure Unexpected missing node.parent.parent in axis "+e;b=p.parent.parent}b.level>u&&b.isAll===!0&&(x=!1)}x&&(p.level===m?N.push(p):n.fn.chaseAllNodesToLeafToList(p.parent,p,m,N))}l=N,a.debug&&(console.log("AdhocDataProcessor.getNodeListForDimensionLevelsMeasure: 3w948h  non-LeafLevel qualified children    X"),console.log(l))}}return l},getNodeListForActualLevel:function(e,r,n,t){for(var o=a,s=0;s<r.length;s++){var l=r[s];l.level==n?t.push(l):l.children&&o.fn.getNodeListForActualLevel(e,l.children,n,t)}},chaseAllNodesToLeafToList:function(e,r,n,t){var o=a;if(r.level<n&&"children"in r&&r.children.length>0)for(var s=0;s<r.children.length;s++){var l=r.children[s],i=!1;if(l.isAll===!1?l.level==o.measureLevelNumber&&(i=!0):i=!0,i){var u=o.fn.chaseAllNodesToLeafToList(e,l,n,t);u.level===n&&t.push(u)}}return r},recurseLeafArrayFromSimpleNode:function(e,r){var n=a;if(e.children.length>0)for(var t=e.children,o=0;o<t.length;o++)n.fn.recurseLeafArrayFromSimpleNode(t[o],r);else r.push(e)},getDataFromRowColumn:function(e,r){if(!e)throw"dataprocessor.getDataFromRowColumn   NULL row object !";if(e.axisCoordinate<0)throw"dataprocessor.getDataFromRowColumn   row Coordinate < 0 !";if(!r)throw"dataprocessor.getDataFromRowColumn   NULL column object !";if(r.axisCoordinate<0)throw"dataprocessor.getDataFromRowColumn   column Coordinate < 0 !";return a.data[e.axisCoordinate][r.axisCoordinate]},getLabelNameArray:function(e,r){var n=a,t=[];if(null===r)return t;var o=r;if(n.metadata.isOLAP){var s=(r.level,n.dimensionLevels[e]),l=0;if(s)for(var i=0;i<s.length;i++)if(l=i,o.level>=s[i].startLevel&&o.level<=s[i].endLevel){for(;o.parent;){if(!o.isAll){t.push(o.label);break}if(!o.parent)break;if(o=o.parent,o.level<s[i].startLevel)break}break}for(var i=l-1;i>=0;i--){var u=s[i].startLevel,d=s[i].endLevel;for(o=r;o.parent;)if(o=o.parent,o.level<=d&&o.level>=u&&o.level>0&&!o.isAll){t.push(o.label);break}}}else{for(;null!=o.parent;)o.isAll!==!0&&t.push(o.label),o=o.parent;o.level>0&&t.push(o.label)}return t.length<=0&&t.push(this.getMessage("totalsLabelForChart")),t},isOLAP:function(){var e=a;return e.metadata.isOLAP},isMeasuresLastOnAxis:function(e){var r=a;if(e!==r.measureAxis)return!1;if(r.fn.isOLAP()){var n=r.dimensionMappings[e];if(n.length<=0)return!1;var t=n[n.length-1],o=t[0];return"Measures"===o.dimension?!0:!1}var s=r.metadata.axes[e];return"Measures"===s[s.length-1].label?!0:!1},doPathsMatch:function(e,a){for(;e.parent;){if(0===e.parent.level)return 0===a.parent.level?!0:!1;if(!a.parent)return!1;if(e=e.parent,a=a.parent,e.level!==a.level)return!1;if(e.label!==a.label)return!1}return a.parent?!1:!0},getLevelsWithoutMeasures:function(a){return e.filter(a,function(e){return"Measures"!=e.dimension})},getLevelIndex:function(e,a){for(var r=0;r<e.length;r++)if(e[r].name===a.name)return r;throw"Specified level was not found."},levelsToLevelNumbers:function(e,r){var n=a.fn,t=[];if(n.isOLAP()){var o=n.getOLAPDimensionInfo();t=n._getOlapLevelNumbers(e,o[r])}else t=n._getNonOlapDataProcessorLevelNumber(e,a.metadata.axes[r]);return t},_getOlapLevelNumbers:function(r,n){var t=a.fn;return e.map(r,function(a){var r=e.find(n,function(e){return e.dimension===a.dimension});return{level:t._getOlapDataProcessorLevelNumber(a,r)}})},_getOlapDataProcessorLevelNumber:function(e,a){for(var r=0;r<a.levels.length;r++)if(a.levels[r].levelName===e.name)return a.levels[r].levelNumber;throw"No olap info found for specified level = "+e.name},_getNonOlapDataProcessorLevelNumber:function(e,r){var n=a.fn;if(0==e.length)return 0;var t=n.getLevelsWithoutMeasures(r);return n.getLevelIndex(t,e[0])+1}}};return{messages:{},getMessage:a.fn.getMessage,load:a.fn.load,levelsToLevelNumbers:a.fn.levelsToLevelNumbers,getLevelIndex:a.fn.getLevelIndex,getLevelsWithoutMeasures:a.fn.getLevelsWithoutMeasures,getOLAPDimensionInfo:a.fn.getOLAPDimensionInfo,getDataFromRowColumn:a.fn.getDataFromRowColumn,getLabelNameArray:a.fn.getLabelNameArray,isMeasuresLastOnAxis:a.fn.isMeasuresLastOnAxis,getDataStyle:a.fn.getDataStyle,getNodeListForDimLevelRadio:a.fn.getNodeListForDimLevelRadio,getNodeListForSliderLevel:a.fn.getNodeListForSliderLevel,getColumnSliderLevelCount:function(){return a.colSliderLevelCount},getRowSliderLevelCount:function(){return a.rowSliderLevelCount}}},this);