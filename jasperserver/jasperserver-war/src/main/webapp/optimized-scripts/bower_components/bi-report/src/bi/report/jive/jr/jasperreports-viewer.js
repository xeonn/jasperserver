define(["jasperreports-loader","./jasperreports-report","jquery.ui","./jasperreports-url-manager"],function(e,t,n,o){var a=function(e){this.config={at:null,reporturi:null,async:!0,page:0,toolbar:!0,applicationContextPath:null},n.extend(this.config,e),this.config.applicationContextPath&&(o.applicationContextPath=this.config.applicationContextPath),this.reportInstance=null,this.container=null,this.undoRedoCounters={undos:0,redos:0}};return e.prototype._errHandler=function(e){var t,o=n.parseJSON(e.responseText),a="errDialog",s=n("#"+a);1!=s.size&&(s=n("<div id='"+a+"'></div>"),n("body").append(s)),t="<p>"+o.msg+"</p>",o.devmsg&&(t+="<p>"+o.devmsg+"</p>"),s.html(t),s.dialog({title:"Error",width:530,height:200})},a.prototype={loadReport:function(){var e=this;return e.reportInstance=new t({reporturi:e.config.reporturi,async:e.config.async,page:e.config.page,container:e._getContainer()}),e._setupEventsForReport(e.reportInstance),e.reportInstance.init()},_render:function(e){this._getContainer().html(e)},_getContainer:function(){if(!this.container){var e=this.config.at;this.container=n(e),this.container.length||(this.container=n("#"+e),this.container.length||(this.container=n("."+e))),this.container.addClass("_jr_report_container_")}return this.container},_setupEventsForReport:function(e){var t=this,o=n("#toolbar");e.on("reportHtmlReady",function(){t._render(this.html),t._updateToolbarPaginationButtons(o)}).on("action",function(){this.gotoPage(0),t.undoRedoCounters.undos++,t.undoRedoCounters.redos=0,t._updateUndoRedoButtons(o)}).on("beforeAction",function(){this.cancelStatusUpdates()}).on("undo",function(){this.gotoPage(0),t.undoRedoCounters.redos++,t.undoRedoCounters.undos--,t.undoRedoCounters.undos<=0&&(t.undoRedoCounters.undos=0),t._updateUndoRedoButtons(o)}).on("redo",function(){this.gotoPage(0),t.undoRedoCounters.undos++,t.undoRedoCounters.redos--,t.undoRedoCounters.redos<=0&&(t.undoRedoCounters.redos=0),t._updateUndoRedoButtons(o)}).on("search",function(e){if(e.actionResult.searchResults&&e.actionResult.searchResults.length){var t=e.actionResult.searchResults;t.sort(function(e,t){return e.page-t.page}),this.gotoPage(t[0].page).then(function(){n(".jr_search_result").addClass("highlight")})}else e.actionResult.searchString&&alert("No results for: "+e.actionResult.searchString)}).on("pageModified",function(){this.refreshPage(this.currentpage)}).on("reportFinished",function(){this.status.pageFinal?t._updateToolbarPaginationButtons(o):this.refreshPage(this.currentpage)}).on("componentsRegistered",function(){var e,o=t.reportInstance.components,a=[];n.each(o,function(t,n){n.length>0&&(e=n[0].config.uimodule,e&&a.push(e))}),a.length&&require(a,function(){n.each(arguments,function(e,n){n.init(t.reportInstance)})}),o.chart&&n.each(o.chart,function(){var e=n("#"+this.config.hcinstancedata.renderto).length;e&&this.render()})}),o.on("click",function(t){var o=n(t.target);o.is(".disabledViewerButton")||(o.is(".pageNext")?e.gotoPage(parseInt(e.currentpage)+1):o.is(".pagePrevious")?e.gotoPage(parseInt(e.currentpage)-1):o.is(".pageFirst")?e.gotoPage(0):o.is(".pageLast")?e.gotoPage(e.status.totalPages-1):o.is(".undo")?e.undo():o.is(".redo")&&e.redo())})},_updateUndoRedoButtons:function(e){var t=this,o=t._toolbarUtils,a=t.undoRedoCounters,s=n(".undo",e),r=n(".redo",e);a.undos>0?o.enableElem(s):o.disableElem(s),a.redos>0?o.enableElem(r):o.disableElem(r)},_updateToolbarPaginationButtons:function(e){var t=this,o=t.reportInstance.currentpage,a=t.reportInstance.status.totalPages,s=n(".pageFirst",e),r=n(".pagePrevious",e),i=n(".pageNext",e),u=n(".pageLast",e),l=n(".undo",e),d=n(".redo",e),c=t._toolbarUtils,g=c.getClassEnabled(),p=c.getClassDisabled();null==a?(c.enableElem(i),c.disableElem(u)):a>1&&a-1>o?c.enablePair(i,u):c.disablePair(i,u),0==o?c.disablePair(s,r):c.enablePair(s,r),l.hasClass(g)||l.hasClass(p)||c.disableElem(l),d.hasClass(g)||d.hasClass(p)||c.disableElem(d)},_toolbarUtils:function(){var e="enabledViewerButton",t="disabledViewerButton";return{getClassEnabled:function(){return e},getClassDisabled:function(){return t},enableElem:function(n){n.removeClass(t),n.addClass(e)},disableElem:function(n){n.removeClass(e),n.addClass(t)},enablePair:function(e,t){this.enableElem(e),this.enableElem(t)},disablePair:function(e,t){this.disableElem(e),this.disableElem(t)}}}()},a});