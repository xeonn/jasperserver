var Observable,__hasProp={}.hasOwnProperty,__extends=function(t,e){function n(){this.constructor=t}for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__slice=[].slice;Observable=function(){function t(t){var e,n;if(this._init(),null!=t)for(e in t)n=t[e],this[e]=n}return t.SetOperationFailed=function(t){function e(t,e,n){this.message="Setting ["+e+"] to ["+n+"] on ["+t+"] failed"}return __extends(e,t),e}(Error),t.makeObservable=function(t){var e,n,i;i=this.prototype;for(e in i)n=i[e],t[e]=n;return t._init()},t.prototype.set=function(){var t,e,n,i,r,o;return t=1<=arguments.length?__slice.call(arguments,0):[],e=this.beginBatch(),i=function(){var e;if(1===t.length){r=t[0],e=[];for(n in r)o=r[n],e.push(this._setOne(n,o));return e}return this._setOne(t[0],t[1])}.call(this),e&&this.endBatch(),i},t.prototype.get=function(t){var e,n,i,r;return n=t.split("."),this._computedPropertyStack.length>0&&(e=this._computedPropertyStack[this._computedPropertyStack.length-1],null==(r=(i=this._dependentKeypathsByKeypath)[t])&&(i[t]={}),this._dependentKeypathsByKeypath[t][e]=!0),this._followAndGetKeypathSegments(this,n,t)},t.prototype.invalidate=function(t,e,n){var i,r,o;if(i=this.beginBatch(),t in this._invalidationByKeypath?this._invalidationByKeypath[t].newValue=n:this._invalidationByKeypath[t]={oldValue:e,newValue:n},o=this._dependentKeypathsByKeypath[t],null!=o)for(r in o)this.invalidate(r,null,null);return i?this.endBatch():void 0},t.prototype.on=function(t,e){var n,i;return null==(i=(n=this._observersByKeypath)[t])&&(n[t]=[]),this._observersByKeypath[t].push(e)},t.prototype.off=function(t,e){var n,i,r;return i=this._observersByKeypath[t],null!=i&&(n=i.indexOf(e),-1!==n)?([].splice.apply(i,[n,n-n+1].concat(r=[])),r):void 0},t.prototype.beginBatch=function(){return this._inBatch?!1:(this._inBatch=!0,!0)},t.prototype.endBatch=function(){var t,e,n,i,r,o,s;if(this._inBatch){this._inBatch=!1,s=this._invalidationByKeypath;for(e in s){if(t=s[e],i=this._observersByKeypath[e],null!=i)for(r=0,o=i.length;o>r;r++)(n=i[r])(e,t.oldValue,t.newValue);delete this._invalidationByKeypath[e]}return!0}return!1},t.prototype._init=function(){return this._observersByKeypath={},this._dependentKeypathsByKeypath={},this._computedPropertyStack=[],this._inBatch=!1,this._invalidationByKeypath={}},t.prototype._setOne=function(t,e){var n,i;return i=t.split("."),n=this._followAndSetKeypathSegments(this,i,e),this.invalidate(t,n,e),n},t.prototype._followAndGetKeypathSegments=function(t,e,n){var i,r;return 1===e.length?"observableLike"===this._getObjectType(t)?t.get(e[0]):this._invokeIfNecessary(t[e[0]],n):"observableLike"===this._getObjectType(t)?t.get(e.join(".")):(i=e.shift(),i in t?(r=this._invokeIfNecessary(t[i],n),this._followAndGetKeypathSegments(r,e,n)):void 0)},t.prototype._followAndSetKeypathSegments=function(e,n,i){var r,o,s;if(1!==n.length)return"observableLike"===this._getObjectType(e)?e.set(n.join("."),i):(r=n.shift(),s=r in e?this._invokeIfNecessary(e[r],null):e[r]={},this._followAndSetKeypathSegments(s,n,i));switch(this._getObjectType(e)){case"observableLike":return o=e.get(n[0]),e.set(n[0],i),o;case"mapLike":case"self":return o=e[n[0]],e[n[0]]=i,o;default:throw new t.SetOperationFailed(e,n[0],i)}},t.prototype._invokeIfNecessary=function(t,e){if("function"!=typeof t)return t;this._computedPropertyStack.push(e);try{return t.apply(this)}finally{this._computedPropertyStack.pop()}},t.prototype._getObjectType=function(t){return null!=t?t===this?"self":"function"==typeof t.set?"observableLike":"[object Array]"===Object.prototype.toString.call(t)?"array":t instanceof Object?"mapLike":"other":"nullLike"},t}(),define(["require"],function(){return Observable});