JRS.Controls=function(e,t,i){function n(e){this.set({selection:e})}function s(e){var t=e.toUpperCase().replace(/([\s]+$|^[\s]+)/g,"");return t.replace(/[\s]*(\+|\-)[\s]*/g,"$1")}function a(e,t){if(!e)return null;for(var i={},n=0;n<e.length;n++){var s=e[n];if(s.selected&&(i[n]=s.value,t))break}return i}var l;require(["common/util/parse/date"],function(e){l=e});var o,r,d;return require(["common/component/singleSelect/view/SingleSelect"],function(e){o=e}),require(["common/component/multiSelect/view/MultiSelect"],function(e){r=e}),require(["common/component/singleSelect/dataprovider/CacheableDataProvider"],function(e){d=e}),t.extend(i,{Bool:i.BaseControl.extend({update:function(e){var t=this.getElem(),i=t.find("input");"true"==e?i.prop("checked",!0):i.removeAttr("checked")},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=null==e.target.getValue()?"false":"true";this.set({selection:t})},this))}}),SingleValueText:i.BaseControl.extend({update:function(e){var t=e==ControlsBase.NULL_SUBSTITUTION_VALUE?ControlsBase.NULL_SUBSTITUTION_LABEL:e,i=this.getElem();i&&(i.find("input").attr("value",t),i.find("input").val(t))},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=e.target.value,i=t==ControlsBase.NULL_SUBSTITUTION_LABEL?ControlsBase.NULL_SUBSTITUTION_VALUE:t;this.set({selection:i})},this))}}),SingleValueNumber:i.BaseControl.extend({update:function(e){this.getElem().find("input").attr("value",e),this.getElem().find("input").val(e)},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){this.set({selection:e.target.value})},this))}}),SingleValueDate:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedDateToIsoDate(t)},set:function(e,t){e.values&&(e.values=l.isoDateToLocalizedDate(e.values)),i.BaseControl.prototype.set.call(this,e,t)},setupCalendar:function(){var i=this.getElem().find("input");i.datepicker({showOn:"button",dateFormat:JRS.i18n.bundledCalendarFormat,changeMonth:!0,changeYear:!0,showButtonPanel:!0,disabled:i[0].disabled,onSelect:t.bind(n,this),onChangeMonthYear:null,beforeShow:e.datepicker.movePickerRelativelyToTriggerIcon,constrainInput:!1}),i.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(s(t.target.value)),n.call(this,e(t.target).val())},this)),i.after("&nbsp;");var a=this.getElem().find("button");a.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleValueDatetime:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},setupCalendar:function(){var i=this.getElem().find("input");i.datetimepicker({showOn:"button",dateFormat:JRS.i18n.bundledCalendarFormat,timeFormat:JRS.i18n.bundledCalendarTimeFormat,showSecond:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0,disabled:i[0].disabled,onSelect:t.bind(n,this),onChangeMonthYear:null,beforeShow:e.datepicker.movePickerRelativelyToTriggerIcon,constrainInput:!1}),i.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(s(t.target.value)),n.call(this,e(t.target).val())},this)),i.after("&nbsp;");var a=this.getElem().find("button");a.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedTimestampToIsoTimestamp(t)},set:function(e,t){e.values&&(e.values=l.isoTimestampToLocalizedTimestamp(e.values)),i.BaseControl.prototype.set.call(this,e,t)},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleValueTime:i.BaseControl.extend({initialize:function(e){this.baseRender(e),e.visible&&this.setupCalendar()},setupCalendar:function(){var i=this.getElem().find("input");i.timepicker({showOn:"button",timeFormat:JRS.i18n.bundledCalendarTimeFormat,showSecond:!0,disabled:i[0].disabled,onClose:t.bind(n,this),beforeShow:e.datepicker.movePickerRelativelyToTriggerIcon,constrainInput:!1}),i.change(t.bind(function(t){t.stopPropagation(),e(t.target).val(s(t.target.value)),n.call(this,e(t.target).val())},this)),i.after("&nbsp;");var a=this.getElem().find("button");a.wrap(ControlsBase.CALENDAR_ICON_SPAN).empty()},get:function(e){var t=i.BaseControl.prototype.get.call(this,e);return l.localizedTimeToIsoTime(t)},set:function(e,t){e.values&&(e.values=l.isoTimeToLocalizedTime(e.values)),i.BaseControl.prototype.set.call(this,e,t)},update:function(e){var t=this.getElem();t.find("input").attr("value",e),t.find("input").val(e)}}),SingleSelect:i.BaseControl.extend({baseRender:function(n){this.singleSelect||(this.dataProvider=new d,this.singleSelect=new o({getData:this.dataProvider.getData}).setDisabled(n.readOnly)),n&&t.extend(this,n);var s=i.TemplateEngine.createTemplate(this.type);if(s){this.singleSelect.undelegateEvents();var a=e(s(this));this.singleSelect.render().renderData(),a.find(".ssPlaceholder").append(this.singleSelect.el),this.setElem(a),this.singleSelect.delegateEvents()}},update:function(e){this.dataProvider.setData(e);var t=this;this.singleSelect.fetch(function(){t.singleSelect.setValue(a(e,!0),{silent:!0})})},bindCustomEventListeners:function(){this.singleSelect.off("selection:change").on("selection:change",function(e){this.set({selection:e})},this)}}),MultiSelect:i.BaseControl.extend({INITIAL_MAX_HEIGHT:"240px",baseRender:function(n){this.multiSelect||(this.dataProvider=new d,this.multiSelect=new r({getData:this.dataProvider.getData}).setDisabled(n.readOnly)),n&&t.extend(this,n);var s=i.TemplateEngine.createTemplate(this.type);if(s){this.multiSelect.undelegateEvents();var a=e(s(this));this.multiSelect.render().renderData(),a.find(".msPlaceholder").append(this.multiSelect.el),this.setElem(a),this.multiSelect.delegateEvents()}},update:function(e){this.dataProvider.setData(e);var t=this;this.multiSelect.fetch(function(){var i=a(e);t.multiSelect.setValue(i,{silent:!0}),t.checkSelectionSize(i)})},bindCustomEventListeners:function(){this.multiSelect.off("selection:change").on("selection:change",function(e){this.set({selection:e}),this.checkSelectionSize(e)},this)},get:function(e){var i=this[e];return"selection"==e&&t.isEmpty(i)?[ControlsBase.NOTHING_SUBSTITUTION_VALUE]:i},checkSelectionSize:function(e){var t=0;for(var i in e)if(e.hasOwnProperty(i)&&t++>=4)break;5>t&&this.getElem()[0].clientHeight<125?(this.getElem().find(".sizer").addClass("hidden"),this.getElem().find(".inputSet").removeClass("sizable").attr("style",!1)):this.resizable&&(this.getElem().find(".sizer").removeClass("hidden"),this.getElem().find(".inputSet").addClass("sizable"))},makeResizable:function(){this.resizable=!0;var t=this.getElem().find(".sList"),i=t.parents(".leaf").find(".sizer").removeClass("hidden");i.addClass("ui-resizable-handle ui-resizable-s"),t.resizable({handles:{s:i}}),t.one("resize",function(){var t=e(this).height();e(this).css("max-height","").css("height",t)}),t.css("max-height",this.INITIAL_MAX_HEIGHT)}}),SingleSelectRadio:i.BaseControl.extend({update:function(n){var s=((new Date).getTime(),this.getElem().find("ul")[0]),a=t.map(n,function(e){var i=t.clone(e);return i.readOnly=this.readOnly,i.name=this.getOptionName(),i.uuid=t.uniqueId(this.id),i},this),l=this.getTemplateSection("data");i.Utils.setInnerHtml(s,l,{data:a}),s.innerHTML+="&nbsp;",e(s).find("li").length<5&&this.getElem()[0].clientHeight<125?(this.getElem().find(".sizer").addClass("hidden"),this.getElem().find(".inputSet").removeClass("sizable").attr("style",!1)):this.resizable&&(this.getElem().find(".sizer").removeClass("hidden"),this.getElem().find(".inputSet").addClass("sizable"))},getOptionName:function(){return this.id+"_option"},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(e){var t=e.target.value,i=this;setTimeout(function(){i.set({selection:t})})},this))},makeResizable:function(){this.resizable=!0;var e=this.getElem().find("ul"),t=this.getElem().find(".sizer").removeClass("hidden");t.addClass("ui-resizable-handle ui-resizable-s"),e.resizable({handles:{s:t}})}}),MultiSelectCheckbox:i.BaseControl.extend({update:function(n){var s=t.map(n,function(e){var i=t.clone(e);return i.readOnly=this.readOnly,i.uuid=t.uniqueId(this.id),i},this),a=this.getElem().find("ul")[0],l=this.getTemplateSection("data");i.Utils.setInnerHtml(a,l,{data:s}),e(a).find("li").length<5&&this.getElem()[0].clientHeight<125?(this.getElem().find(".sizer").addClass("hidden"),this.getElem().find(".inputSet").removeClass("sizable").attr("style",!1)):this.resizable&&(this.getElem().find(".sizer").removeClass("hidden"),this.getElem().find(".inputSet").addClass("sizable"))},getSelection:function(){var i=this.getElem().find(":checkbox").filter(":checked");return t.map(i,function(t){return e(t).val()})},bindCustomEventListeners:function(){this.getElem().on("change","input",t.bind(function(){var e=this.getSelection(),t=this;setTimeout(function(){t.set({selection:e})})},this)),this.getElem().on("click","a",t.bind(function(i){var n=this.getElem().find("input"),s=e(i.target)[0].name;"multiSelectAll"===s||"multiSelectNone"===s?t.each(n,function(e){e.checked="multiSelectAll"===s}):"multiSelectInverse"===s&&t.each(n,function(e){e.checked=!e.checked}),this.getElem().find("input").change()},this))},get:function(e){var i=this[e];return"selection"==e&&t.isEmpty(i)?[ControlsBase.NOTHING_SUBSTITUTION_VALUE]:i},makeResizable:function(){this.resizable=!0;var e=this.getElem().find("ul"),t=this.getElem().find(".sizer").removeClass("hidden");t.addClass("ui-resizable-handle ui-resizable-s"),e.resizable({handles:{s:t}})}})})}(jQuery,_,JRS.Controls);