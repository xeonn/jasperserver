jaspersoft.components.AuthorityPickerView=function(e,t,i,s){function n(e,t,i){return i<=Math.max(e,t)&&i>=Math.min(e,t)}return i.View.extend({events:{"click .button.search":"search","click .button.searchClear":"clear","keydown input[type=text]":"keyHandler","mousedown li":"selectionStarted","mouseenter li":"mouseEntered","mouseleave li":"mouseLeave","mouseup ul":"selectionFinished","mouseenter ul":"stopScroll","mouseleave ul":"startScroll"},cursor:-1,baseCursor:-1,selecting:!1,scrollSpeed:30,initialize:function(e){this.mainTemplateId="authorityPickerTemplate",this.optionsTemplateId="authorityPickerOptions",this.model.on("change",t.bind(this.renderList,this)),this.model.on("error:server",t.bind(function(){this.trigger("error:server",arguments)},this)),this.upHandler=t.bind(function(e){this.stopScroll(e),this.selecting=!1},this),this.el=!1,this.initOptions=e},render:function(){return this.mainTemplate||(this.mainTemplate=s.createTemplate(this.mainTemplateId)),this.optionsTemplate||(this.optionsTemplate=s.createTemplate(this.optionsTemplateId)),this.el||(this.$el=e("<div/>").html(this.mainTemplate(this.initOptions)).children(),this.el=this.$el[0],this.subEl=this.$el.find(".authorityPicker ul"),this.delegateEvents()),this.model.setContext(),this},renderList:function(){return this.subEl.html(this.optionsTemplate(this.model.attributes)).find("li").each(function(t,i){e(i).attr("index",t)}),this.cursor=-1,this.baseCursor=-1,this.scrollSpeed=this.subEl.find("li:eq(0)").height(),this.subEl.scrollTop(0),this.trigger("change:selection",[]),this},getSelected:function(){return t.reduce(this.subEl.find(".selected"),function(i,s){return i.push(t.pluck(e(s).find("span"),"innerHTML").join("|")),i},[])},search:function(){var e=this.$el.find("input[type=text]").val();this.model.setContext({searchString:e}),e?this.$el.find(".button.searchClear").addClass("up"):this.$el.find(".button.searchClear").removeClass("up")},clear:function(){this.$el.find("input[type=text]").val(""),this.search()},keyHandler:function(e){13===e.which&&this.search()},setDisabled:function(e){e?(this.subEl.addClass("disabled"),this.undelegateEvents()):(this.subEl.removeClass("disabled"),this.delegateEvents()),this.$el.find("input[type=text]").attr("disabled",e)},highlightSet:function(i){this.subEl.find("li").each(function(s,n){n=e(n),n.toggleClass("highlighted",t.contains(i,t.pluck(n.find("span"),"innerHTML").join("|")))})},selectAll:function(t){this.subEl.find("li").each(function(t,i){e(i).addClass("selected")}),t||this.trigger("change:selection",this.getSelected())},selectNone:function(t){this.subEl.find("li").each(function(t,i){e(i).removeClass("selected")}),t||this.trigger("change:selection",this.getSelected())},selectInverse:function(t){this.subEl.find("li").each(function(t,i){e(i).toggleClass("selected")}),t||this.trigger("change:selection",this.getSelected())},selectItem:function(e,t){this.subEl.find("li[index="+e+"]").addClass("selected"),t||this.trigger("change:selection",this.getSelected())},unSelectItem:function(e,t){this.subEl.find("li[index="+e+"]").removeClass("selected"),t||this.trigger("change:selection",this.getSelected())},selectRange:function(t,i,s){var n=Math.min(t,i),l=Math.max(t,i);this.subEl.find("li:lt("+(l+1)+")").each(function(t,i){t>=n&&e(i).addClass("selected")}),s||this.trigger("change:selection",this.getSelected())},selectionStarted:function(t){this.selecting=!0,t.ctrlKey||t.metaKey||this.selectNone(!0);var i=+e(t.target).parents("li").toggleClass("selected").attr("index");t.shiftKey?-1!=this.cursor&&this.selectRange(this.cursor,i,!0):(this.cursor=i,this.baseCursor=this.cursor)},mouseEntered:function(t){this.selecting&&(this.cursor=+e(t.target).parents("li").addClass("selected").attr("index"))},mouseLeave:function(t){if(this.selecting){var i=e(t.target).parents("li"),s=e(t.relatedTarget).parents("li");n(this.cursor,this.baseCursor,+s.attr("index"))&&i.removeClass("selected")}},selectionFinished:function(){this.selecting=!1,this.trigger("change:selection",this.getSelected())},startScroll:function(i){if(this.selecting){if(e(i.relatedTarget).hasClass("upper"))this.direction=-1;else{if(!e(i.relatedTarget).hasClass("lower"))return void(this.selecting=!1);this.direction=1}e(document.body).on("mouseup",this.upHandler),this.scrollTimer=setInterval(t.bind(this.scrollList,this),200)}},stopScroll:function(){this.selecting&&(clearInterval(this.scrollTimer),this.direction=0,e(document.body).off("mouseup",this.upHandler))},scrollList:function(){this.subEl.scrollTop(+this.subEl.scrollTop()+this.scrollSpeed*this.direction),n(this.cursor,this.baseCursor,this.cursor+this.direction)?this.unSelectItem(this.cursor,!0):this.selectItem(this.cursor+this.direction,!0),this.cursor=this.cursor+this.direction}})}(jQuery,_,Backbone,jaspersoft.components.templateEngine);