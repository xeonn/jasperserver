JRS.Controls=function(e,t,n,i){var r=navigator.userAgent.toLowerCase().indexOf("msie")>-1;return{Base:t.extend(function(){},{extend:function(e,n){var i,r=this;i=e&&t.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},t.extend(i,r,n);var o=function(){this.constructor=i};return o.prototype=r.prototype,i.prototype=new o,e&&t.extend(i.prototype,e),i.__super__=r.prototype,i}}),TemplateEngine:{render:function(e,i,r){if(!r)return n.to_html(e,i);if(r==this.STD_PLACEHOLDERS){var o=String(e);return t.each(i,function(e,t){var n=new RegExp("\\{"+t+"\\}");o=o.replace(n,e)}),o}},renderUrl:function(e,t,i){var o=n.to_html(e,t);return r&&!i&&(o=encodeURI(o)),o},getTemplateText:function(t){var n=e("#"+t);return n.html()},createTemplate:function(t){var i=e("#"+t),r=i.html();return r&&r.length>0?function(e){return n.to_html(r,e)}:void 0},createTemplateSection:function(e,t){var i="\\{\\{#val\\}\\}(\\s|\\S)*\\{\\{/val\\}\\}",r=i.replace(/val/g,e),o=new RegExp(r,"g"),a=this.getTemplateText(t),u=a.match(o)[0];return function(e){return n.to_html(u,e)}},STD_PLACEHOLDERS:"std_placeholder"},Utils:{LOADING_DIALOG_DELAY:800,isElementInDom:function(e){var t=e.nextSibling,n=e.parentNode&&!(11===e.parentNode.nodeType);return t||n},setInnerHtml:function(e,n,i){var o,a;if(this.isElementInDom(e)){o=e.nextSibling,a=e.parentNode;var u=e.style.display;e.style.display="none",a.removeChild(e)}if(e.innerHTML="",r&&"SELECT"==e.tagName){var s=document.createDocumentFragment();t.each(i.data,function(e){var n=document.createElement("OPTION");n.value=t.isUndefined(e.value)?e.id:e.value,n.innerHTML=e.label,e.selected&&n.setAttribute("selected","selected"),s.appendChild(n)}),e.appendChild(s)}else e.innerHTML=n(i);if(o?a.insertBefore(e,o):a.appendChild(e),e.style.display=u,r&&"SELECT"==e.tagName){var c=e.getAttribute("style");e.removeAttribute("style"),e.setAttribute("style",c)}},wait:function(t){return e.Deferred(function(e){setTimeout(e.resolve,t)})},showLoadingDialogOn:function(n,r,o){this.wait(r?r:this.LOADING_DIALOG_DELAY).then(t.bind(function(){"pending"==n.state()&&(i.popup.show($(ajax.LOADING_ID),o,{focus:!1}),e.when(n).always(t.bind(function(){this.wait(500).then(function(){window.viewer&&window.viewer.loading?window.viewer.loaded&&i.popup.hide($(ajax.LOADING_ID)):i.popup.hide($(ajax.LOADING_ID))})},this)))},this))},createTimer:function(t){var n=new e.Deferred;return n.done(function(e){var n=(new Date).getTime(),i=n-e;console.log(t+" took time: "+i+" msec.")}),{start:function(){return this.startTime=(new Date).getTime(),this},stop:function(){return n.resolve(this.startTime),this}}}},listen:function(n,i){t.each(n,function(n,i){e(document).bind(i,t.bind(n,this))},i?i:this)},ignore:function(t,n){e(document).unbind(t,n)}}}(jQuery,_,Mustache,dialogs);