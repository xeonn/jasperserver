JRS.Export.ExtendedFormView=function(e,s,t,i,o,n,r){var l=navigator.userAgent.toLowerCase().indexOf("msie")>-1;return i.View.extend({events:{"keyup #exportDataFile #filenameId":"editFileName","change #exportOptions #everything":"exportEverything","change #exportOptions #includeSystemProperties":"includeSystemProperties","change #exportOptions #roleUsers":"includeRolesByUsers","change #exportOptions #usersRoles":"includeUsersWithRoles","change #exportOptions #noUsersRoles":"includeSelectedRolesUsersOnly","change #exportOptions #includeAccessEvents":"includeAccessEvents","change #exportOptions #includeAuditEvents":"includeAuditEvents","change #exportOptions #includeMonitoringEvents ":"includeMonitoringEvents","click #exportOptions .checkBox label":"clickOnCheckbox","click #exportButton":"sendParameters"},initialize:function(){t.bindAll(this),this.rolesList=new r({model:n.instance("rest_v2/roles{{#searchString}}?search={{searchString}}{{/searchString}}"),customClass:"selectedRoles",title:e.i18n["export.select.roles"]}),this.rolesList.on("change:selection",this.bindWithRoles),this.rolesList.render(),this.usersList=new r({model:n.instance("rest_v2/users{{#searchString}}?search={{searchString}}{{/searchString}}"),customClass:"select selectedUsers",title:e.i18n["export.select.users"]}),this.usersList.on("change:selection",this.bindWithUsers),this.usersList.render(),this.rolesToUsers=n.instance("rest_v2/users?hasAllRequiredRoles=false{{#roles}}&requiredRole={{.}}{{/roles}}"),this.rolesToUsers.on("change",this.onRolesToUsersChange),this.usersToRoles=n.instance("rest_v2/roles?hasAllUsers=false{{#users}}&user={{.}}{{/users}}"),this.usersToRoles.on("change",this.onUsersToRolesChange),this.fileTemplate=o.createTemplate("exportDataFileTemplate"),this.optionsTemplate=o.createTemplate("exportOptionsTemplates"),this.controlsTemplate=o.createTemplate("controlButtonsTemplate"),this.model.on("change",this.onModelChange)},render:function(e){var t=this.fileTemplate({defaultFileName:this.model.get("fileName")}),i=this.optionsTemplate({everything:this.model.get("everything"),includeSystemProperties:this.model.get("includeSystemProperties"),userForRoles:this.model.get("userForRoles"),rolesForUser:this.model.get("rolesForUser"),includeAccessEvents:this.model.get("includeAccessEvents"),includeAuditEvents:this.model.get("includeAuditEvents")}),o=this.controlsTemplate();return e&&e.container?(this.undelegateEvents(),this.$el=s(e.container),this.el=this.$el[0],this.$el.find(".body").append(t+i),this.$el.find(".footer").prepend(o),this.delegateEvents()):this.$el.html(t+i+o),this.$el.find("#selectRolesUsers").append(this.rolesList.el).append(this.usersList.el),l&&this.$el.find("#exportDataFile #filenameId").on("propertychange input",this.editFileName),this.changeEnabledState(this.model.get("everything")),this},bindWithRoles:function(e){this.model.set({roles:e}),this.onUsersToRolesChange(),e.length?this.rolesToUsers.setContext({roles:e}):this.rolesToUsers.set({items:[]})},bindWithUsers:function(e){this.model.set({users:e}),this.onRolesToUsersChange(),e.length?this.usersToRoles.setContext({users:e}):this.usersToRoles.set({items:[]})},changeEnabledState:function(e){this.rolesList.setDisabled(e||this.model.get("rolesForUser")),this.usersList.setDisabled(e||this.model.get("userForRoles")),this.$el.find("#roleUsers").prop("disabled",e),this.$el.find("#usersRoles").prop("disabled",e),this.$el.find("#noUsersRoles").prop("disabled",e),this.$el.find("#includeAccessEvents").prop("disabled",!e).prop("checked",this.model.get("includeAccessEvents"))},editFileName:function(e){var t=s(e.target),i=this.$el.find("#exportButton").prop("disabled",!1);t.parent().removeClass("error"),this.model.once("invalid",function(e,s){t.next().html(s),t.parent().addClass("error"),i.prop("disabled",!0)}),this.model.set("fileName",t.val(),{validate:!0})},exportEverything:function(e){var t=s(e.target).is(":checked");this.model.set({everything:t}),this.changeEnabledState(t),t&&(this.rolesList.selectNone(),this.usersList.selectNone())},includeSystemProperties:function(e){var t=s(e.target).is(":checked");this.model.set({includeSystemProperties:t})},includeRolesByUsers:function(e){var t=s(e.target).is(":checked");this.model.set({rolesForUser:!t,userForRoles:t}),this.onRolesToUsersChange(),this.rolesList.setDisabled(!t),this.usersList.setDisabled(t),this.rolesList.selectNone(),this.usersList.selectNone()},includeUsersWithRoles:function(e){var t=s(e.target).is(":checked");this.model.set({rolesForUser:t,userForRoles:!t}),this.onUsersToRolesChange(),this.rolesList.setDisabled(t),this.usersList.setDisabled(!t),this.rolesList.selectNone(),this.usersList.selectNone()},includeSelectedRolesUsersOnly:function(e){s(e.target).is(":checked")&&(this.model.set({userForRoles:!1,rolesForUser:!1}),this.onRolesToUsersChange(),this.onUsersToRolesChange(),this.rolesList.setDisabled(!1),this.usersList.setDisabled(!1),this.rolesList.selectNone(),this.usersList.selectNone())},includeAccessEvents:function(e){var t=s(e.target).is(":checked");this.model.set({includeAccessEvents:t})},includeAuditEvents:function(e){var t=s(e.target).is(":checked");this.model.set({includeAuditEvents:t})},includeMonitoringEvents:function(e){var t=s(e.target).is(":checked");this.model.set({includeMonitoringEvents:t})},sendParameters:function(){this.model.isValid()&&this.model.isAcceptable()&&this.isValid()&&this.model.save()},clickOnCheckbox:function(e){var t=s(e.target).next();t[0].disabled||(t[0].checked=!t[0].checked,t.trigger("change"))},isValid:function(){return!this.$el.find("fieldset .error").length},onModelChange:function(){var e=this.$el.find("#exportButton");e.prop("disabled",!(this.model.isAcceptable()&&this.isValid()))},onRolesToUsersChange:function(){this.model.get("userForRoles")?(this.usersList.highlightSet(t.map(this.rolesToUsers.get("items"),function(e){return e.username+(e.tenantId?"|"+e.tenantId:"")})),this.rolesList.highlightSet([])):this.usersList.highlightSet([])},onUsersToRolesChange:function(){this.model.get("rolesForUser")?(this.rolesList.highlightSet(t.map(this.usersToRoles.get("items"),function(e){return e.name+(e.tenantId?"|"+e.tenantId:"")})),this.usersList.highlightSet([])):this.rolesList.highlightSet([])}})}(JRS.Export,jQuery,_,Backbone,jaspersoft.components.templateEngine,jaspersoft.components.AuthorityModel,jaspersoft.components.AuthorityPickerView,jaspersoft.components.State);